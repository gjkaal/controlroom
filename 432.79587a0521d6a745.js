"use strict";(self.webpackChunkechelon=self.webpackChunkechelon||[]).push([[432],{4432:(j,h,l)=>{l.r(h),l.d(h,{StreamTargetModule:()=>L});var s=l(9697),_=l(3075),u=l(9808),t=l(5e3),b=l(655),g=l(4987),C=l(567),x=l(2125),T=l(5439),M=l(5686),S=l(8946);function D(r,a){if(1&r&&(t.TgZ(0,"nb-option",26),t._uU(1),t.qZA()),2&r){const e=a.$implicit;t.Q6J("value",e.reference),t.xp6(1),t.hij(" ",e.displayValue," ")}}function I(r,a){if(1&r&&(t.TgZ(0,"p",37),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Oqu(n.formatDate(null==e?null:e.date))}}function O(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"input",38),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(3).editedItem.dateForTarget=i}),t.qZA()}if(2&r){t.oxw();const e=t.MAs(5),n=t.oxw(2);t.Q6J("nbDatepicker",e)("ngModel",n.editedItem.dateForTarget)}}function w(r,a){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit,n=t.oxw(3);t.xp6(1),t.Oqu(n.getStreamName(e.streamReference))}}function Z(r,a){if(1&r&&(t.TgZ(0,"nb-option",26),t._uU(1),t.qZA()),2&r){const e=a.$implicit;t.Q6J("value",e.reference),t.xp6(1),t.hij(" ",e.displayValue," ")}}function v(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"nb-select",49),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(4).editedItem.streamReference=i}),t.YNc(1,Z,2,2,"nb-option",17),t.qZA()}if(2&r){const e=t.oxw(4);t.Q6J("ngModel",e.editedItem.streamReference),t.xp6(1),t.Q6J("ngForOf",e.streamsSelectList)}}function y(r,a){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit,n=t.oxw(3);t.xp6(1),t.Oqu(n.numberWithDots(e.initialTargetValue))}}function A(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"input",50),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(4).editedItem.initialTargetValue=i}),t.qZA()}if(2&r){const e=t.oxw().$implicit,n=t.oxw(3);t.s9C("value",e.initialTargetValue),t.Q6J("ngModel",n.editedItem.initialTargetValue)}}function P(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"i",51),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw().$implicit;return t.oxw(2).openEdit(o,i)}),t.qZA()}}function k(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"i",52),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(3).saveEdit(i)}),t.qZA()}}function F(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"i",53),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,o=t.oxw().$implicit;return t.oxw(2).cancelEdit(o,i)}),t.qZA()}}function J(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"i",54),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(3).onDelete(i.uuid)}),t.qZA()}}function N(r,a){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t.YNc(2,w,2,1,"p",39),t.YNc(3,v,2,2,"nb-select",40),t.qZA(),t.TgZ(4,"td",41),t.YNc(5,y,2,1,"p",39),t.YNc(6,A,1,2,"input",42),t.qZA(),t.TgZ(7,"td")(8,"p"),t._uU(9),t.qZA()(),t.TgZ(10,"td")(11,"p"),t._uU(12),t.qZA()(),t.TgZ(13,"td")(14,"div",43),t.YNc(15,P,1,0,"i",44),t.YNc(16,k,1,0,"i",45),t.YNc(17,F,1,0,"i",46),t.YNc(18,J,1,0,"i",47),t.qZA()(),t._UZ(19,"td",48),t.qZA()),2&r){const e=a.$implicit,n=t.oxw().$implicit,i=t.oxw(2);t.xp6(2),t.Q6J("ngIf",e.disabled),t.xp6(1),t.Q6J("ngIf",!e.disabled),t.xp6(2),t.Q6J("ngIf",e.disabled),t.xp6(1),t.Q6J("ngIf",!e.disabled),t.xp6(3),t.Oqu(e.lastModified?i.formatLastEditedDate(e.lastModified):""),t.xp6(3),t.Oqu(e.lastModifiedBy),t.xp6(3),t.Q6J("ngIf",i.formControlState(n,e)),t.xp6(1),t.Q6J("ngIf",!i.formControlState(n,e)),t.xp6(1),t.Q6J("ngIf",!i.formControlState(n,e)),t.xp6(1),t.Q6J("ngIf",i.formControlState(n,e))}}function q(r,a){if(1&r&&(t.TgZ(0,"tr")(1,"td"),t.YNc(2,I,2,1,"p",27),t.YNc(3,O,1,2,"input",28),t._UZ(4,"nb-datepicker",29,30),t.qZA(),t.TgZ(6,"td",31)(7,"table",32)(8,"tbody")(9,"tr"),t._UZ(10,"th",33)(11,"th",34)(12,"th",35)(13,"th",36)(14,"th")(15,"th"),t.qZA(),t.YNc(16,N,20,10,"tr",25),t.qZA()()()()),2&r){const e=a.$implicit;t.xp6(2),t.Q6J("ngIf",e.disabled),t.xp6(1),t.Q6J("ngIf",!e.disabled),t.xp6(13),t.Q6J("ngForOf",e.streamTargets)}}const Y=function(r){return{"date-col":!0,active:r}},Q=function(r,a){return{"iconEcheclon date-icon-arrow":!0,"icon-arrow-down":r,"icon-arrow-up":a}};function E(r,a){if(1&r){const e=t.EpF();t.TgZ(0,"table",4)(1,"thead",5)(2,"tr")(3,"th",6)(4,"div",7)(5,"label",8)(6,"span"),t._uU(7,"Date"),t.qZA(),t.TgZ(8,"input",9),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().filteringDate=i})("focus",function(){return t.CHM(e),t.oxw().onDateFocus()})("blur",function(){return t.CHM(e),t.oxw().onDateBlur()}),t.qZA(),t._UZ(9,"i",10),t.qZA(),t.TgZ(10,"nb-datepicker",11,12),t.NdJ("dateChange",function(i){return t.CHM(e),t.oxw().onChangeFilteringDate(i)}),t.qZA()()(),t.TgZ(12,"th",13)(13,"label",14)(14,"span",15),t._uU(15,"Stream"),t.qZA(),t.TgZ(16,"nb-select",16),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().filteringStream=i})("selectedChange",function(i){return t.CHM(e),t.oxw().onFilterByStream(i)}),t.YNc(17,D,2,2,"nb-option",17),t.qZA()()(),t.TgZ(18,"th",18),t._uU(19,"Target"),t.qZA(),t.TgZ(20,"th",19),t._uU(21,"Last Edited"),t.qZA(),t.TgZ(22,"th",20),t._uU(23,"Name"),t.qZA(),t.TgZ(24,"th",21),t._uU(25,"Actions"),t.qZA(),t.TgZ(26,"th",22)(27,"div",23)(28,"nb-icon",24),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.qZA()()()()(),t.TgZ(29,"tbody"),t.YNc(30,q,17,3,"tr",25),t.qZA()()}if(2&r){const e=t.MAs(11),n=t.oxw();t.xp6(3),t.Q6J("ngClass",t.VKq(7,Y,n.editingDate)),t.xp6(5),t.Q6J("nbDatepicker",e)("ngModel",n.filteringDate),t.xp6(1),t.Q6J("ngClass",t.WLB(9,Q,!n.editingDate,n.editingDate)),t.xp6(7),t.Q6J("ngModel",n.filteringStream),t.xp6(1),t.Q6J("ngForOf",n.streamsSelectList),t.xp6(13),t.Q6J("ngForOf",n.streamTargetsData)}}let m=class{constructor(a,e,n,i,o){this.cdr=a,this.dialog=e,this.toastrService=n,this.streamTargetApi=i,this.streamApi=o,this.dataAvailable=!1,this.streamsSelectList=[],this.dailyStreamTargets=[],this.editable=!1,this.positions=s.fe3,this.streamTargetsData=[],this.editedItem={},this.createMode=!1,this.filteringDate=null,this.filteringStream=[],this.editingDate=!1}ngOnInit(){this.findData()}onChangeFilteringDate(a){this.filteringDate=a,this.filterByDate()}onClearFilters(){this.filteringDate=null,this.filteringStream=[],this.editingDate=!1,this.buildStreamTargetsList()}onFilterByStream(a){var e;if(this.buildStreamTargetsList(),this.filteringDate=null,!(null===(e=this.filteringStream)||void 0===e?void 0:e.length))return;let n=[...this.streamTargetsData];n=n.map(i=>Object.assign(Object.assign({},i),{streamTargets:i.streamTargets.filter(o=>a.includes(o.streamReference))})).filter(i=>i.streamTargets.length),this.streamTargetsData=n}filterByDate(){this.buildStreamTargetsList(),this.filteringStream=[];const a=[...this.streamTargetsData].filter(e=>e.date.getTime()===this.filteringDate.getTime());this.streamTargetsData=a}formatDate(a){return T(new Date(a)).format("YYYY-MM-DD")}formatLastEditedDate(a){const e=T(a);return`${e.format("YYYY-MM-DD")} ${e.format("HH:mm")}`}getStreamName(a){var e,n;return null===(n=null===(e=this.streamsSelectList)||void 0===e?void 0:e.find(i=>i.reference===a))||void 0===n?void 0:n.displayValue}buildStreamTargetsList(){this.streamTargetsData=this.dailyStreamTargets.map(a=>(a.streamTargets=a.streamTargets.map(e=>Object.assign(Object.assign({},e),{disabled:!0,dateForTarget:new Date(a.dateForTarget)})),Object.assign(Object.assign({},a),{disabled:!0,date:new Date(a.date)})))}onAdd(){this.createMode=!0,this.streamTargetsData.push({disabled:!1,streamTargets:[{disabled:!1}]}),this.cdr.markForCheck()}onDateFocus(){this.editingDate=!0}onDateBlur(){this.editingDate=!1}onDelete(a){const e=this.dialog.open(x.D);e.componentRef.instance.title="Remove Stream Target",e.componentRef.instance.text="Are you sure you want to remove this stream target?",e.onBackdropClick.pipe((0,g.t)(this)).subscribe(()=>{e.close()}),e.componentRef.instance.completed.pipe((0,g.t)(this)).subscribe(n=>{this.streamTargetApi.dataStreamtargetDeleteUuidDelete(a).pipe((0,g.t)(this)).subscribe({next:()=>{this.findData(),this.cdr.markForCheck(),e.close(),this.showToast(this.positions.TOP_RIGHT,"success","Stream Target succesfully removed.",3e3)},error:()=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}})})}onRemove(a){var e;const n=this.streamTargetsData.findIndex(i=>i.uuid===a);this.streamTargetsData.splice(n,1),null===(e=this.dailyStreamTargets)||void 0===e||e.splice(n,1),this.cdr.markForCheck()}openEdit(a,e){if(this.editedItem.uuid)return;const n=this.streamTargetsData.find(c=>a.date===c.date),i=n.streamTargets.find(c=>c.uuid===e.uuid),o=this.streamTargetsData.findIndex(c=>a.date===c.date),d=n.streamTargets.findIndex(c=>c.uuid===e.uuid);n.disabled=!1,i.disabled=!1,i.dateForTarget=n.date,this.editedItem=Object.assign({},i);const p=[...this.streamTargetsData];n[d]=i,p[o]=n,this.streamTargetsData=p,this.cdr.markForCheck()}cancelEdit(a,e){if(this.createMode)return this.streamTargetsData.pop(),this.cdr.markForCheck(),void(this.createMode=!1);const n=this.streamTargetsData.find(c=>a.date===c.date),i=n.streamTargets.find(c=>c.uuid===e.uuid),o=this.streamTargetsData.findIndex(c=>a.date===c.date),d=n.streamTargets.findIndex(c=>c.uuid===e.uuid);n.disabled=!0,i.disabled=!0;const p=[...this.streamTargetsData];n[d]=i,p[o]=n,this.streamTargetsData=p,this.editedItem={},this.cdr.markForCheck()}numberWithDots(a){return a.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g,".")}formControlState(a,e){return this.streamTargetsData.find(i=>a.date===i.date).streamTargets.find(i=>i.uuid===e.uuid).disabled}checkIfDateUnique(a){const e=this.streamTargetsData.find(n=>{var i;return(null===(i=n.date)||void 0===i?void 0:i.getTime())===a.getTime()});return!e||!e.streamTargets.some(n=>n.streamReference===this.editedItem.streamReference)}saveEdit(a){const{streamReference:e,initialTargetValue:n}=this.editedItem,i=this.editedItem.dateForTarget;if(!this.checkIfDateUnique(i)&&this.createMode)return void this.showToast(this.positions.TOP_RIGHT,"danger","Stream target with this date already exists",3e3);const d={streamReference:e,initialTargetValue:n,dateForTarget:T(new Date(i.getFullYear(),i.getMonth(),i.getDate())).toISOString(!0)};this.createMode?this.streamTargetApi.dataStreamtargetCreatePost(d).pipe((0,g.t)(this)).subscribe({next:p=>{this.findData(),this.editedItem={},this.showToast(this.positions.TOP_RIGHT,"success","Stream target succesfully created.",3e3),this.createMode=!1},error:()=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}}):this.streamTargetApi.dataStreamtargetUpdateUuidPut(this.editedItem.uuid,d).pipe((0,g.t)(this)).subscribe({next:p=>{this.findData(),this.editedItem={},this.showToast(this.positions.TOP_RIGHT,"success","Stream target succesfully updated.",3e3)},error:()=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}})}findData(){(0,C.D)(this.streamTargetApi.dataStreamtargetDailyStreamTargetsGet(),this.streamApi.dataOrchestrationAllStreamsGet()).pipe((0,g.t)(this)).subscribe({next:([a,e])=>{this.dailyStreamTargets=a.content,this.streamsSelectList=e.selectItems,this.buildStreamTargetsList(),this.dataAvailable=!0,this.cdr.markForCheck()}})}getWarningInfo(a){const e=null==a?void 0:a.map(n=>n.displayValue).join(". ");return null!=e?e:""}showToast(a,e,n,i=5e3,o=""){!n||this.toastrService.show(e||"Success",n,{icon:o,position:a,status:e,duration:i,destroyByClick:!0,limit:1})}};m.\u0275fac=function(a){return new(a||m)(t.Y36(t.sBO),t.Y36(s.Gln),t.Y36(s.quB),t.Y36(M.fy),t.Y36(S.EI))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-stream-target-table"]],decls:6,vars:3,consts:[[1,"spinner-wrapper","overflow-auto",3,"nbSpinner"],[1,"d-flex","justify-content-end","mb-1"],["nbButton","","status","primary",3,"disabled","click"],["class","table",4,"ngIf"],[1,"table"],[1,"stream-target-table-thead"],["scope","col",3,"ngClass"],[1,"date-wrapper"],["for","fDate"],["id","fDate","nbInput","","status","control","placeholder","",3,"nbDatepicker","ngModel","ngModelChange","focus","blur"],[3,"ngClass"],["format","yyyy-MM-dd",1,"filter-datepicker",3,"dateChange"],["fDate",""],["scope","col",1,"stream-filter-col"],["for","fStream",1,"stream-filter-label"],[1,"stream-filter-label-text"],["status","control","placeholder","Stream","multiple","","id","fStream",1,"editable-input","stream-filter-select",3,"ngModel","ngModelChange","selectedChange"],[3,"value",4,"ngFor","ngForOf"],["scope","col",1,"target-col"],["scope","col",1,"last-edited-col"],["scope","col",1,"name-edited-col"],["scope","col text-right"],["scope","col"],[1,"float-right"],["title","Create","icon","add_circle",3,"click"],[4,"ngFor","ngForOf"],[3,"value"],["class","mb-0 date-p",4,"ngIf"],["nbInput","","status","control","placeholder","Date",3,"nbDatepicker","ngModel","ngModelChange",4,"ngIf"],["format","yyyy-MM-dd"],["date",""],["colspan","6",1,"p-0"],[1,"stream-target-subtable"],[1,"stream-filter-col"],[1,"target-col"],[1,"last-edited-col"],[1,"name-edited-col"],[1,"mb-0","date-p"],["nbInput","","status","control","placeholder","Date",3,"nbDatepicker","ngModel","ngModelChange"],[4,"ngIf"],["status","control","placeholder","Select stream...","class","select","class","editable-input",3,"ngModel","ngModelChange",4,"ngIf"],[1,"target-cell"],["status","primary","nbInput","","type","number","class","editable-input target-input",3,"value","ngModel","ngModelChange",4,"ngIf"],[1,"icons-wrapper"],["class","iconEcheclon icon-edit cursor-pointer mr-1",3,"click",4,"ngIf"],["class","iconEcheclon icon-confirm cursor-pointer mr-1",3,"click",4,"ngIf"],["class","iconEcheclon icon-close cursor-pointer",3,"click",4,"ngIf"],["class","iconEcheclon icon-bin cursor-pointer",3,"click",4,"ngIf"],[1,"text-right"],["status","control","placeholder","Select stream...",1,"editable-input",3,"ngModel","ngModelChange"],["status","primary","nbInput","","type","number",1,"editable-input","target-input",3,"value","ngModel","ngModelChange"],[1,"iconEcheclon","icon-edit","cursor-pointer","mr-1",3,"click"],[1,"iconEcheclon","icon-confirm","cursor-pointer","mr-1",3,"click"],[1,"iconEcheclon","icon-close","cursor-pointer",3,"click"],[1,"iconEcheclon","icon-bin","cursor-pointer",3,"click"]],template:function(a,e){1&a&&(t.ynx(0),t.TgZ(1,"div",0)(2,"div",1)(3,"button",2),t.NdJ("click",function(){return e.onClearFilters()}),t._uU(4," Clear filters "),t.qZA()(),t.YNc(5,E,31,12,"table",3),t.qZA(),t.BQk()),2&a&&(t.xp6(1),t.Q6J("nbSpinner",!e.dataAvailable),t.xp6(2),t.Q6J("disabled",null===e.filteringDate&&!(null!=e.filteringStream&&e.filteringStream.length)),t.xp6(2),t.Q6J("ngIf",e.dataAvailable))},directives:[s.Q7R,s.DPz,u.O5,u.mk,s.h8i,s.$kf,_.Fj,_.JJ,_.On,s.B4C,s.rs,u.sg,s.q51,s.fMN,_.wV],styles:[".stream-target-subtable[_ngcontent-%COMP%]{width:100%;border-top:0}.stream-target-subtable[_ngcontent-%COMP%]   .select-button[_ngcontent-%COMP%]{width:130px}.stream-target-subtable[_ngcontent-%COMP%]   .target-input[_ngcontent-%COMP%]{width:120px;max-width:120px}.stream-target-subtable[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{padding:0}.stream-target-subtable[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-top:0}.stream-target-subtable[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2)   td[_ngcontent-%COMP%]{border-top:0}.stream-target-subtable[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}.stream-target-subtable[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.stream-target-subtable[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stream-target-subtable[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{width:150px}.stream-target-subtable[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:0}.stream-target-table-thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{width:150px;vertical-align:middle}.stream-target-table-thead[_ngcontent-%COMP%]   th.date-col[_ngcontent-%COMP%]{min-width:330px}.stream-target-table-thead[_ngcontent-%COMP%]   th.date-col.active[_ngcontent-%COMP%]{background-color:var(--color-primary-500)}.stream-filter-col[_ngcontent-%COMP%], .stream-filter-col[_ngcontent-%COMP%]   .select-button[_ngcontent-%COMP%]{min-width:180px}.text-right[_ngcontent-%COMP%]{text-align:right}.target-cell[_ngcontent-%COMP%]{padding-left:16px}.date-p[_ngcontent-%COMP%]{margin-top:10px}.last-edited-col[_ngcontent-%COMP%], .name-edited-col[_ngcontent-%COMP%]{min-width:170px}.target-col[_ngcontent-%COMP%]{min-width:135px}  .stream-filter-select .select-button{background-color:transparent!important;border:none!important;font-size:18px!important;padding-left:0!important;padding-right:42px!important;font-weight:700!important;padding-bottom:0!important}.date-wrapper[_ngcontent-%COMP%]   [nbInput][_ngcontent-%COMP%]{border:none!important;background-color:transparent!important}.date-wrapper[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:0;cursor:pointer}.date-wrapper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:35px}.date-wrapper[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:6px;transform:translateY(-3px);font-weight:700;margin-top:8px}  nb-datepicker-container{transform:translate(-18px,4px);border-top:3px solid var(--color-primary-800)!important}"],changeDetection:0}),m=(0,b.gn)([(0,g.c)()],m);let U=(()=>{class r{constructor(){}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-stream-target-list"]],decls:3,vars:0,template:function(e,n){1&e&&(t.TgZ(0,"h1"),t._uU(1,"Stream Target"),t.qZA(),t._UZ(2,"app-stream-target-table"))},directives:[m],styles:[""]}),r})();var f=l(6798);const H=[{path:"",component:U}];let R=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[f.Bz.forChild(H)],f.Bz]}),r})();var B=l(8242),$=l(1428);let L=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[u.ez,R,_.u5,s.uuI,s.OA,s.nKr,s.IIj,_.UX,s.LW9,s.rgH,s.KdK,$.k,B.i,s.MfT,s.T2N]]}),r})()}}]);