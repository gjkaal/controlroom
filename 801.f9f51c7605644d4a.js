"use strict";(self.webpackChunkechelon=self.webpackChunkechelon||[]).push([[801],{7801:(pe,x,m)=>{m.r(x),m.d(x,{OccupationTodayModule:()=>_e});var F=m(6460),O=m(5942),g=m(9808),s=m(6781),p=m(3075),A=m(2601),k=m(5173),e=m(5e3);let W=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.ez,s.T2N,s.zyh,s.KdK,O.vP,p.u5,p.UX,s.OA,s.kmq,s.nKr,s.IIj,s.oGl,A.r,k.i,s.COg]]}),o})();var C=m(655),T=m(4987),q=m(4362);function w(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"nb-option",29),e.NdJ("selectionChange",function(r){e.CHM(n);const c=e.oxw().index,a=e.oxw(2).$implicit;return e.oxw(2).onSelectedWorkstationChange(r,c,a,"occupation")}),e._uU(1),e.qZA()}if(2&o){const n=t.$implicit;e.Q6J("id",null==n||null==n.value?null:n.value.reference)("value",""===(null==n?null:n.reference)||null==n?null:n.reference),e.xp6(1),e.hij("",null==n?null:n.name," ")}}function J(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function N(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function U(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function D(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function I(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"tr",1)(1,"td")(2,"nb-select",19),e.YNc(3,w,2,3,"nb-option",20),e.qZA(),e.YNc(4,J,2,0,"span",21),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"input",22),e.YNc(9,N,2,0,"span",21),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",23)(12,"nb-timepicker",24,25),e.YNc(14,U,2,0,"span",21),e.qZA(),e.TgZ(15,"td"),e._UZ(16,"input",26)(17,"nb-timepicker",24,27),e.YNc(19,D,2,0,"span",21),e.qZA(),e.TgZ(20,"td")(21,"div",28)(22,"nb-icon",10),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2).$implicit;return e.oxw(2).onAddOccupation(r)}),e.qZA(),e.TgZ(23,"nb-icon",11),e.NdJ("click",function(){const c=e.CHM(n).index,a=e.oxw(2).$implicit;return e.oxw(2).onRemoveOccupation(a,c)}),e.qZA()()()()}if(2&o){const n=t.$implicit,i=e.MAs(13),r=e.MAs(18),c=e.oxw(2).$implicit,a=e.oxw(2);let d,l,u,_;e.Q6J("formGroup",a.castToFormGroup(n)),e.xp6(2),e.Q6J("appEditable",!(null!=n&&null!=n.value&&n.value.name)),e.xp6(1),e.Q6J("ngForOf",a.getWorkstationsList(c)),e.xp6(1),e.Q6J("ngIf",(null==(d=n.get("reference"))?null:d.touched)&&(null==(d=n.get("reference"))?null:d.getError("required"))),e.xp6(2),e.Oqu(n.value.activity.displayValue),e.xp6(3),e.Q6J("ngIf",(null==(l=n.get("occupation"))?null:l.touched)&&(null==(l=n.get("occupation"))?null:l.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",i),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(u=n.get("startTime"))?null:u.touched)&&(null==(u=n.get("startTime"))?null:u.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",r),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(_=n.get("endTime"))?null:_.touched)&&(null==(_=n.get("endTime"))?null:_.getError("required")))}}function E(o,t){if(1&o&&(e.ynx(0),e.YNc(1,I,24,12,"tr",18),e.BQk()),2&o){const n=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.getArrayFromGroup(n,"occupation").controls)}}function G(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"div",28)(3,"nb-icon",10),e.NdJ("click",function(){e.CHM(n);const r=e.oxw().$implicit;return e.oxw(2).onAddOccupation(r)}),e.qZA()()()()}}function M(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"nb-option",29),e.NdJ("selectionChange",function(r){e.CHM(n);const c=e.oxw().index,a=e.oxw(2).$implicit;return e.oxw(2).onSelectedWorkstationChange(r,c,a,"ratio")}),e._uU(1),e.qZA()}if(2&o){const n=t.$implicit;e.Q6J("id",null==n||null==n.value?null:n.value.reference)("value",""===(null==n?null:n.reference)||null==n?null:n.reference),e.xp6(1),e.hij("",null==n?null:n.name," ")}}function Q(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function S(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function V(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function R(o,t){1&o&&(e.TgZ(0,"span",30),e._uU(1," This field is required "),e.qZA())}function Y(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"tr",1)(1,"td")(2,"nb-select",19),e.YNc(3,M,2,3,"nb-option",20),e.qZA(),e.YNc(4,Q,2,0,"span",21),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"input",31),e.YNc(9,S,2,0,"span",21),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",23)(12,"nb-timepicker",24,25),e.YNc(14,V,2,0,"span",21),e.qZA(),e.TgZ(15,"td"),e._UZ(16,"input",26)(17,"nb-timepicker",24,27),e.YNc(19,R,2,0,"span",21),e.qZA(),e.TgZ(20,"td")(21,"div",28)(22,"nb-icon",10),e.NdJ("click",function(){e.CHM(n);const r=e.oxw(2).$implicit;return e.oxw(2).onAddRatio(r)}),e.qZA(),e.TgZ(23,"nb-icon",11),e.NdJ("click",function(){const c=e.CHM(n).index,a=e.oxw(2).$implicit;return e.oxw(2).onRemoveRatio(a,c)}),e.qZA()()()()}if(2&o){const n=t.$implicit,i=e.MAs(13),r=e.MAs(18),c=e.oxw(2).$implicit,a=e.oxw(2);let d,l,u,_;e.Q6J("formGroup",a.castToFormGroup(n)),e.xp6(2),e.Q6J("appEditable",!(null!=n&&null!=n.value&&n.value.name)),e.xp6(1),e.Q6J("ngForOf",a.getWorkstationsList(c)),e.xp6(1),e.Q6J("ngIf",(null==(d=n.get("reference"))?null:d.touched)&&(null==(d=n.get("reference"))?null:d.getError("required"))),e.xp6(2),e.Oqu(n.value.activity.displayValue),e.xp6(3),e.Q6J("ngIf",(null==(l=n.get("ratio"))?null:l.touched)&&(null==(l=n.get("ratio"))?null:l.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",i),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(u=n.get("startTime"))?null:u.touched)&&(null==(u=n.get("startTime"))?null:u.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",r),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(_=n.get("endTime"))?null:_.touched)&&(null==(_=n.get("endTime"))?null:_.getError("required")))}}function H(o,t){if(1&o&&(e.ynx(0),e.YNc(1,Y,24,12,"tr",18),e.BQk()),2&o){const n=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.getArrayFromGroup(n,"ratio").controls)}}function P(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"div",28)(3,"nb-icon",10),e.NdJ("click",function(){e.CHM(n);const r=e.oxw().$implicit;return e.oxw(2).onAddOccupation(r)}),e.qZA()()()()}}function j(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"nb-accordion-item",4)(1,"nb-accordion-item-header")(2,"div",5)(3,"div",6)(4,"div")(5,"span",7),e._uU(6,"Workcenter"),e.qZA(),e.TgZ(7,"span",8),e._uU(8),e.qZA()()()()(),e.TgZ(9,"nb-accordion-item-body")(10,"div",9)(11,"nb-icon",10),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).onOpenWorkcenterAddDialog("add","")}),e.qZA(),e.TgZ(12,"nb-icon",11),e.NdJ("click",function(){const c=e.CHM(n).$implicit;return e.oxw(2).onOpenWorkcenterAddDialog("remove",c.value.uuid)}),e.qZA()(),e.TgZ(13,"div",12)(14,"table",13)(15,"thead")(16,"tr")(17,"th"),e._uU(18,"Workstation"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Activity"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Occupation"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Start"),e.qZA(),e.TgZ(25,"th"),e._uU(26,"End"),e.qZA(),e.TgZ(27,"th"),e._UZ(28,"br"),e.qZA()()(),e.TgZ(29,"tbody"),e.YNc(30,E,2,1,"ng-container",14),e.YNc(31,G,4,0,"ng-template",null,15,e.W1O),e.qZA()(),e.TgZ(33,"table",16)(34,"thead")(35,"tr")(36,"th"),e._uU(37,"Workstation"),e.qZA(),e.TgZ(38,"th"),e._uU(39,"Activity"),e.qZA(),e.TgZ(40,"th"),e._uU(41,"Ratio"),e.qZA(),e.TgZ(42,"th"),e._uU(43,"Start"),e.qZA(),e.TgZ(44,"th"),e._uU(45,"End"),e.qZA(),e.TgZ(46,"th"),e._UZ(47,"br"),e.qZA()()(),e.TgZ(48,"tbody"),e.YNc(49,H,2,1,"ng-container",14),e.YNc(50,P,4,0,"ng-template",null,17,e.W1O),e.qZA()()()()()}if(2&o){const n=t.$implicit,i=e.MAs(32),r=e.MAs(51),c=e.oxw(2);e.Q6J("formGroup",c.castToFormGroup(n)),e.xp6(8),e.Oqu(n.value.name),e.xp6(22),e.Q6J("ngIf",c.getArrayFromGroup(n,"occupation").controls.length>0)("ngIfElse",i),e.xp6(19),e.Q6J("ngIf",c.getArrayFromGroup(n,"ratio").controls.length>0)("ngIfElse",r)}}function $(o,t){if(1&o&&(e.ynx(0,1),e.TgZ(1,"nb-accordion",2),e.YNc(2,j,52,6,"nb-accordion-item",3),e.qZA(),e.BQk()),2&o){const n=e.oxw();e.Q6J("formGroup",n.form),e.xp6(2),e.Q6J("ngForOf",n.workcentersControl.controls)}}let v=class{constructor(t,n){this.fb=t,this.cdr=n,this.editable=!0,this.workcentersFilter=[],this.workstationsFilter=[],this._workcenters=[],this.searchText="",this.openWorkcenterAddDialog=new e.vpe,this.formValuesChange=new e.vpe,this.isFormValid=new e.vpe}set workcenters(t){!(null==t?void 0:t.length)||t===this._workcenters||(this._workcenters=t,this.createworkCentersForm(),this.watchFormChanges())}get workcenters(){return this._workcenters}ngOnChanges(t){var n,i,r,c;this.workcentersFilter=null===(i=null===(n=null==t?void 0:t.selectedFilters)||void 0===n?void 0:n.currentValue)||void 0===i?void 0:i.workcenters,this.workstationsFilter=null===(c=null===(r=null==t?void 0:t.selectedFilters)||void 0===r?void 0:r.currentValue)||void 0===c?void 0:c.workstations}watchFormChanges(){this.form.valueChanges.pipe((0,T.t)(this)).subscribe(t=>{this.formValuesChange.emit(t),this.isFormValid.emit(this.form.valid)})}onOpenWorkcenterAddDialog(t,n){this.openWorkcenterAddDialog.emit({action:t,uuid:n})}onSelectedWorkstationChange(t,n,i,r){var c;if(!i.value)return;const a=null===(c=null==i?void 0:i.value)||void 0===c?void 0:c.uuid,l=[...this.workcenters.find(_=>_.uuid===a).workstations],u=l.find(_=>_.reference===t.value);l[n]=u,i.patchValue({[r]:l})}get workcentersControl(){var t;return null===(t=this.form)||void 0===t?void 0:t.get("workcentersPlan")}addWorkcenter(){this.workcentersControl.push(this.createWorkCenterGroup())}removeWorkcenter(t){this.workcentersControl.removeAt(t)}getWorkstations(t){return this.workcentersControl.at(t).get("workstations")}addWorkstation(t){this.getWorkstations(t).push(this.createOccupationGroup())}removeWorkstation(t){this.getWorkstations(t).removeAt(t)}onAddOccupation(t){this.getArrayFromGroup(t,"occupation").push(this.createOccupationGroup())}onAddRatio(t){this.getArrayFromGroup(t,"ratio").push(this.createRatioGroup())}onRemoveOccupation(t,n){this.getArrayFromGroup(t,"occupation").removeAt(n)}onRemoveRatio(t,n){this.getArrayFromGroup(t,"ratio").removeAt(n)}getWorkstationsList(t){var n;const i=null===(n=null==t?void 0:t.value)||void 0===n?void 0:n.uuid;return this.workcenters.find(c=>c.uuid===i).workstations}checkIfHasWorkstations(t){var n;return(null===(n=this.workcenters.find(t.value.uuid).workstations)||void 0===n?void 0:n.length)>0}getFilteredArrayGroup(t,n,i){return this.getArrayFromGroup(t,n).controls.filter(a=>""!==a.value.name).filter((a,d,l)=>l.findIndex(u=>u.value.reference===a.value.reference)===d)}createworkCentersForm(){this.form=this.fb.group({workcentersPlan:this.fb.array([...this.workcenters].map(t=>{var n,i;return this.createWorkCenterGroup(null!==(n=t.name)&&void 0!==n?n:t.displayValue,null!==(i=t.uuid)&&void 0!==i?i:t.reference,t.workstations,t.occupation,t.ratio)}))})}createWorkCenterGroup(t="",n="",i=[],r,c){return this.fb.group(r&&c?{name:t,occupation:this.fb.array(r.map(a=>this.createOccupationGroup(a))),ratio:this.fb.array(c.map(a=>this.createRatioGroup(a))),uuid:n,reference:n}:{name:t,occupation:this.fb.array(i.map(a=>this.createOccupationGroup(a))),ratio:this.fb.array(i.map(a=>this.createRatioGroup(a))),uuid:n,reference:n})}createOccupationGroup(t){var n,i,r,c,a,d,l,u,_,f;return this.fb.group({name:[null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"",p.kI.required],activity:null!==(r=null===(i=null==t?void 0:t.activity)||void 0===i?void 0:i.displayValue)&&void 0!==r?r:"",occupation:[null!==(c=null==t?void 0:t.occupation)&&void 0!==c?c:"",p.kI.required],startTime:[null!==(a=this.transformDate(null==t?void 0:t.startTime))&&void 0!==a?a:"",p.kI.required],endTime:[null!==(d=this.transformDate(null==t?void 0:t.endTime))&&void 0!==d?d:"",p.kI.required],reference:[null!==(l=null==t?void 0:t.reference)&&void 0!==l?l:"",p.kI.required],displayValue:null!==(u=null==t?void 0:t.displayValue)&&void 0!==u?u:"",uuid:null!==(_=null==t?void 0:t.uuid)&&void 0!==_?_:"",code:null!==(f=null==t?void 0:t.code)&&void 0!==f?f:""})}createRatioGroup(t){var n,i,r,c,a,d,l,u,_,f,h;return this.fb.group({name:[null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"",p.kI.required],activity:null!==(r=null===(i=null==t?void 0:t.activity)||void 0===i?void 0:i.displayValue)&&void 0!==r?r:"",ratio:[null!==(c=null==t?void 0:t.ratio)&&void 0!==c?c:"",p.kI.required],unitOfRatio:null!==(a=null==t?void 0:t.unitOfRatio)&&void 0!==a?a:"none",startTime:[null!==(d=this.transformDate(null==t?void 0:t.startTime))&&void 0!==d?d:"",p.kI.required],endTime:[null!==(l=this.transformDate(null==t?void 0:t.endTime))&&void 0!==l?l:"",p.kI.required],reference:[null!==(u=null==t?void 0:t.reference)&&void 0!==u?u:"",p.kI.required],displayValue:null!==(_=null==t?void 0:t.displayValue)&&void 0!==_?_:"",uuid:null!==(f=null==t?void 0:t.uuid)&&void 0!==f?f:"",code:null!==(h=null==t?void 0:t.code)&&void 0!==h?h:""})}transformDate(t){if(!t)return"";let n=t.toString();3===n.length&&(n="0"+n),2===n.length&&(n="00"+n);const i=n.substring(0,2)+":"+n.substring(2,n.length),r=new Date("2011-04-20 "+i);return console.log(r),"Invalid Date"!==new Date(r).toString()?r:""}castToFormGroup(t){return t}castToFormArray(t){return t}getArrayFromGroup(t,n,i){return t.get(n)}};v.\u0275fac=function(t){return new(t||v)(e.Y36(p.qu),e.Y36(e.sBO))},v.\u0275cmp=e.Xpm({type:v,selectors:[["app-today-table"]],inputs:{workcenters:"workcenters",selectedFilters:"selectedFilters",searchText:"searchText"},outputs:{openWorkcenterAddDialog:"openWorkcenterAddDialog",formValuesChange:"formValuesChange",isFormValid:"isFormValid"},features:[e.TTD],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["multi","","formArrayName","workcentersPlan"],["expanded","true",3,"formGroup",4,"ngFor","ngForOf"],["expanded","true",3,"formGroup"],[1,"accordion-header"],[1,"d-flex","justify-content-between"],[1,"accordion-title"],[1,"accordion-subtitle"],[1,"buttons-wrapper","workcenter-buttons","mb-3"],["type","button","icon","add_circle",1,"mr-1",3,"click"],["type","button","icon","cancel",1,"mr-1",3,"click"],[1,"tables-wrapper"],["formArrayName","occupation"],[4,"ngIf","ngIfElse"],["addButton",""],["formArrayName","ratio"],["addRatioButton",""],[3,"formGroup",4,"ngFor","ngForOf"],["status","primary","placeholder","Name","formControlName","reference",1,"select",3,"appEditable"],[3,"id","value","selectionChange",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["nbInput","","type","number","fullWidth","","status","primary","placeholder","occupation","formControlName","occupation"],["nbInput","","status","primary","primary","","fullWidth","","formControlName","startTime",3,"nbTimepicker"],["singleColumn","","format","h:mm:ss a",3,"step"],["timeFrom",""],["nbInput","","status","primary","primary","","fullWidth","","formControlName","endTime",3,"nbTimepicker"],["timeTo",""],[1,"buttons-wrapper"],[3,"id","value","selectionChange"],[1,"text-danger"],["type","number","nbInput","","fullWidth","","status","primary","placeholder","Ratio","formControlName","ratio"]],template:function(t,n){1&t&&e.YNc(0,$,3,2,"ng-container",0),2&t&&e.Q6J("ngIf",n.form)},directives:[g.O5,p.JL,p.sg,s.qCO,p.CE,g.sg,s.SaG,s.YZd,s.AvE,s.fMN,s.rs,p.JJ,p.u,q.m,s.q51,s.h8i,p.wV,p.Fj,s.etF,s.emG],styles:[".workcenter-buttons[_ngcontent-%COMP%]{position:absolute;right:0;top:0}"]}),v=(0,C.gn)([(0,T.c)()],v);var Z=m(2268),B=m(567);function z(o,t){if(1&o&&(e.TgZ(0,"nb-option",16),e._uU(1),e.qZA()),2&o){const n=t.$implicit;e.s9C("value",n.uuid),e.xp6(1),e.Oqu(n.name)}}function K(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"label",12),e._uU(3,"Workcenter"),e.qZA()(),e.TgZ(4,"div",13)(5,"nb-select",14),e.NdJ("selectedChange",function(r){return e.CHM(n),e.oxw(2).onSelectWorkcenter(r)}),e.YNc(6,z,2,2,"nb-option",15),e.qZA()()()}if(2&o){const n=e.oxw(2);e.xp6(6),e.Q6J("ngForOf",n.workcenters)}}function X(o,t){1&o&&(e.TgZ(0,"div",10)(1,"div",7)(2,"p"),e._uU(3,"You have added all workcenters to the plan already."),e.qZA()()())}function L(o,t){if(1&o&&(e.TgZ(0,"div",6)(1,"div",7),e.YNc(2,K,7,1,"div",8),e.YNc(3,X,4,0,"ng-template",null,9,e.W1O),e.qZA()()),2&o){const n=e.MAs(4),i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.workcenters.length>0)("ngIfElse",n)}}function ee(o,t){1&o&&(e.TgZ(0,"div",6)(1,"div",7)(2,"p"),e._uU(3,"Are you sure you want to remove this workcenter?"),e.qZA()()())}function te(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return"add"===r.action?r.onSave():r.onRemove()}),e._uU(1),e.qZA()}if(2&o){const n=e.oxw();e.xp6(1),e.hij(" ","add"===n.action?"Save":"Confirm"," ")}}let ne=(()=>{class o{constructor(n){this.dialog=n,this.newWorkcenterUuid="",this.workcenters=[],this.action="",this.workcenterToRemoveUuid="",this.addWorkcenter=new e.vpe,this.removeWorkcenter=new e.vpe}onCloseDialog(){this.dialog.close()}onSelectWorkcenter(n){this.newWorkcenterUuid=n}onSave(){this.addWorkcenter.emit(this.newWorkcenterUuid)}onRemove(){this.removeWorkcenter.emit(!0)}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(s.X4l))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-today-add-workcenter-dialog"]],outputs:{addWorkcenter:"addWorkcenter",removeWorkcenter:"removeWorkcenter"},decls:14,vars:6,consts:[["icon","close",1,"close-dialog",3,"click"],["class","row mb-1",4,"ngIf","ngIfElse"],["confirmText",""],[1,"buttons","d-flex","justify-content-center","mt-5"],["nbButton","","outline","","size","medium","type","button",1,"mr-3",3,"click"],["nbButton","","status","primary","size","medium",3,"click",4,"ngIf"],[1,"row","mb-1"],[1,"col-12"],["class","row",4,"ngIf","ngIfElse"],["noWorkcentersInfo",""],[1,"row"],[1,"col-sm-3","d-flex","align-items-center"],["for","workcenter"],[1,"col-sm-9"],["fullWidth","","status","primary","placeholder","Select workcenter...",1,"select",3,"selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["nbButton","","status","primary","size","medium",3,"click"]],template:function(n,i){if(1&n&&(e.TgZ(0,"nb-card")(1,"nb-card-header")(2,"h2"),e._uU(3),e.ALo(4,"titlecase"),e.qZA(),e.TgZ(5,"nb-icon",0),e.NdJ("click",function(){return i.onCloseDialog()}),e.qZA()(),e.TgZ(6,"nb-card-body"),e.YNc(7,L,5,2,"div",1),e.YNc(8,ee,4,0,"ng-template",null,2,e.W1O),e.TgZ(10,"div",3)(11,"button",4),e.NdJ("click",function(){return i.onCloseDialog()}),e._uU(12,"Cancel"),e.qZA(),e.YNc(13,te,2,1,"button",5),e.qZA()()()),2&n){const r=e.MAs(9);e.xp6(3),e.hij("",e.lcZ(4,4,i.action)," workcenter"),e.xp6(4),e.Q6J("ngIf","add"===i.action)("ngIfElse",r),e.xp6(6),e.Q6J("ngIf",0!==i.workcenters.length||"remove"===i.action)}},directives:[s.Asz,s.ndF,s.fMN,s.yKW,g.O5,s.rs,g.sg,s.q51,s.DPz],pipes:[g.rS],styles:["nb-card[_ngcontent-%COMP%]{min-width:500px}"]}),o})();var y=m(8471),oe=m(890);const ie=function(o){return{active:o}};function re(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){const c=e.CHM(n).$implicit;return e.oxw().onChooseHour(c)}),e._uU(1),e.qZA()}if(2&o){const n=t.$implicit,i=e.oxw();e.Q6J("ngClass",e.VKq(2,ie,i.choosenHours.includes(n))),e.xp6(1),e.hij(" ",n," ")}}let ce=(()=>{class o{constructor(){this.choosenHours=[],this.hours=["07:00","08:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00"],this.selectFilters=new e.vpe,this.selectAll=!1}onChooseHour(n){this.choosenHours.includes(n)?this.choosenHours=this.choosenHours.filter(i=>i!==n):this.choosenHours.push(n)}ngOnChanges(n){var i;console.log(n),n.selectAll&&(this.choosenHours=(null===(i=n.selectAll)||void 0===i?void 0:i.currentValue)?this.hours:[])}}return o.\u0275fac=function(n){return new(n||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-today-filters"]],inputs:{selectAll:"selectAll"},outputs:{selectFilters:"selectFilters"},features:[e.TTD],decls:2,vars:1,consts:[[1,"filters"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0),e.YNc(1,re,2,4,"div",1),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngForOf",i.hours))},directives:[g.sg,g.mk],styles:[".filters[_ngcontent-%COMP%]{display:flex}.filters[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:10px 15px;display:flex;justify-content:center;align-items:center;cursor:pointer;font-size:16px}.filters[_ngcontent-%COMP%]   div.active[_ngcontent-%COMP%]{background-color:#1c2431}"]}),o})();function ae(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"app-today-table",13),e.NdJ("openWorkcenterAddDialog",function(r){return e.CHM(n),e.oxw().onOpenWorkcenterAddDialog(r)})("formValuesChange",function(r){return e.CHM(n),e.oxw().onFormChanges(r)})("isFormValid",function(r){return e.CHM(n),e.oxw().setIsFormValid(r)}),e.qZA()}if(2&o){const n=e.oxw();e.Q6J("workcenters",n.filteredData)("searchText",n.searchText)("selectedFilters",n.selectedFilters)}}let b=class{constructor(t,n,i,r,c,a){this.workCenterApi=t,this.workStationApi=n,this.activityApi=i,this.siteOccupationApi=r,this.dialogService=c,this.cdr=a,this.editable=!1,this.searchText="",this.workCenters=[],this.workStations=[],this.workcentersPlans=[],this.activities=[],this.dataTree=[],this.plan=[],this.planName="",this.workcentersToAdd=[],this.filteredData=[],this.isFormValid=!1,this.planReference="",this.allHoursSelected=!1}ngOnInit(){this.fetchPlanData()}fetchPlanData(){(0,B.D)(this.workCenterApi.dataWorkCenterListGet(),this.workStationApi.dataWorkstationListGet(),this.activityApi.dataActivityListGet(),this.siteOccupationApi.dataSiteOccupationCurrentSiteOccupationGet()).pipe((0,T.t)(this)).subscribe({next:([t,n,i,r])=>{var c,a,d,l;this.workCenters=t,this.workStations=n,this.activities=i,this.editedPlanData=r.content,this.planName=null===(c=r.content)||void 0===c?void 0:c.planName,this.planReference=null===(a=r.content)||void 0===a?void 0:a.planReference,this.workcentersPlans=null!==(l=null===(d=r.content)||void 0===d?void 0:d.workCenterPlans)&&void 0!==l?l:[],console.log(this.workcentersPlans),this.buildDataTree()}})}setIsFormValid(t){this.isFormValid=t}onFormChanges(t){this.plan=t.workcentersPlan}setAllHoursSelected(){this.allHoursSelected=!this.allHoursSelected}buildDataTree(){this.dataTree=[...this.workcentersPlans].map(t=>{var n,i,r;let c="";t.name=t.displayValue,null===(n=t.occupation)||void 0===n||n.forEach((l,u)=>{c||(c=l.workcenterUuid);const _=l.workstationUuid;l.reference=_;const f=this.workStations.find(h=>h.uuid===_);t.occupation[u]=Object.assign(Object.assign({},t.occupation[u]),f)}),null===(i=t.ratio)||void 0===i||i.forEach((l,u)=>{c||(c=l.workcenterUuid);const _=l.workstationUuid;l.name=l.displayValue,l.reference=_;const f=this.workStations.find(h=>h.uuid===_);t.ratio[u]=Object.assign(Object.assign({},t.ratio[u]),f)});const a=c;t.uuid=a;const d=this.workCenters.find(l=>l.uuid===a);return t.workstations=null==d?void 0:d.workstations,null===(r=t.workstations)||void 0===r||r.forEach((l,u)=>{const _=l.reference;l.name=l.displayValue;const f=this.workStations.find(h=>h.uuid===_);t.workstations[u]=Object.assign(Object.assign({},t.workstations[u]),f)}),t}),this.filteredData=[...this.dataTree],console.log(this.dataTree),this.cdr.markForCheck()}formatPlanData(t){return t.map(i=>(i.occupation.forEach(r=>{r.startTime=this.formatTime(r.startTime),r.endTime=this.formatTime(r.endTime)}),i.ratio.forEach(r=>{r.startTime=this.formatTime(r.startTime),r.endTime=this.formatTime(r.endTime)}),i))}formatTime(t){const n=new Date(t);return n?`${`0${n.getHours()}`.slice(-2)}${`0${n.getMinutes()}`.slice(-2)}`:""}formatDate(t){return t.toISOString().substring(0,10).split("-").join("")}savePlan(){const t={planReference:this.planReference,planName:this.planName,isTemplate:!1,workCenterPlans:this.formatPlanData([...this.plan])};this.siteOccupationApi.dataSiteOccupationSavePlanPost(t).pipe((0,T.t)(this)).subscribe({next:n=>{console.log(n)}})}onOpenWorkcenterAddDialog(t){const n=this.dialogService.open(ne);n.componentRef.instance.workcenters=this.workcentersToAdd,n.componentRef.instance.action=t.action,n.componentRef.instance.addWorkcenter.pipe((0,T.t)(this)).subscribe(i=>{if(n.close(),i){const r=this.workCenters.find(a=>a.uuid===i),c=[...this.dataTree,r];this.dataTree=c,this.filteredData=this.dataTree,this.cdr.markForCheck()}}),n.componentRef.instance.removeWorkcenter.pipe((0,T.t)(this)).subscribe(i=>{if(n.close(),"remove"===(null==t?void 0:t.action)&&(null==t?void 0:t.uuid)){const r=this.workCenters.find(a=>a.uuid===(null==t?void 0:t.uuid));this.workcentersToAdd=[...this.workcentersToAdd,r];const c=this.dataTree.filter(a=>a.uuid!==(null==t?void 0:t.uuid));this.dataTree=c,this.filteredData=this.dataTree,this.cdr.markForCheck()}})}};b.\u0275fac=function(t){return new(t||b)(e.Y36(y.Uv),e.Y36(y.F),e.Y36(y.B0),e.Y36(oe.j),e.Y36(s.Gln),e.Y36(e.sBO))},b.\u0275cmp=e.Xpm({type:b,selectors:[["app-today-edit"]],decls:16,vars:3,consts:[[1,"plan-header","mt-3"],[1,"row","mb-3"],[1,"col-12","col-sm-12","col-md-7"],[1,"mt-0"],[1,""],[3,"selectAll"],[1,"col-12","col-sm-12","col-md-5","d-flex","flex-column","justify-content-between"],[1,"buttons","mt-3","d-flex","justify-content-end"],["nbButton","","status","primary","size","medium",1,"icon-button",3,"disabled","click"],["icon","check_circle"],[1,"icon-button-text"],["nbButton","","status","primary","size","medium",1,"ml-1",3,"click"],[3,"workcenters","searchText","selectedFilters","openWorkcenterAddDialog","formValuesChange","isFormValid",4,"ngIf"],[3,"workcenters","searchText","selectedFilters","openWorkcenterAddDialog","formValuesChange","isFormValid"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),e._uU(4,"Today"),e.qZA(),e.TgZ(5,"div",4),e._UZ(6,"app-today-filters",5),e.qZA()(),e.TgZ(7,"div",6)(8,"div",7)(9,"button",8),e.NdJ("click",function(){return n.savePlan()}),e._UZ(10,"nb-icon",9),e.TgZ(11,"span",10),e._uU(12,"Save all"),e.qZA()(),e.TgZ(13,"button",11),e.NdJ("click",function(){return n.setAllHoursSelected()}),e._uU(14,"Show All"),e.qZA()()()(),e.YNc(15,ae,1,3,"app-today-table",12),e.qZA()),2&t&&(e.xp6(6),e.Q6J("selectAll",n.allHoursSelected),e.xp6(3),e.Q6J("disabled",!n.isFormValid),e.xp6(6),e.Q6J("ngIf",n.dataTree))},directives:[ce,s.DPz,s.fMN,g.O5,v],styles:[""]}),b=(0,C.gn)([(0,T.c)()],b);const le=[{path:"",component:b}];let se=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[Z.Bz.forChild(le)],Z.Bz]}),o})();var de=m(8242),ue=m(1428);let _e=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.ez,se,W,s.T2N,s.zyh,s.KdK,s.uuI,s.oGl,s.OA,s.kmq,s.nKr,s.IIj,A.r,k.i,F.n,p.UX,de.i,ue.k,p.u5,s.COg]]}),o})()}}]);