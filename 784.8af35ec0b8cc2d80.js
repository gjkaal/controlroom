"use strict";(self.webpackChunkechelon=self.webpackChunkechelon||[]).push([[784],{6526:(O,f,a)=>{a.d(f,{d:()=>i});var p=a(655),e=a(5e3),g=a(6913),c=a(4987),r=a(6781),h=a(296),_=a(9808);function v(s,o){if(1&s&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&s){const l=e.oxw(2);e.xp6(1),e.Oqu(l.files[0].name)}}const C=function(s){return{"is-drop-over":s}};function M(s,o){if(1&s){const l=e.EpF();e.TgZ(0,"div",6)(1,"div",7),e.NdJ("uploadOutput",function(d){return e.CHM(l),e.oxw().onUploadOutput(d)}),e.TgZ(2,"label",8)(3,"input",9),e.NdJ("uploadOutput",function(d){return e.CHM(l),e.oxw().onUploadOutput(d)}),e.qZA(),e._UZ(4,"nb-icon",10),e._uU(5," Drag and drop file "),e.qZA(),e.YNc(6,v,2,1,"p",11),e.qZA(),e.TgZ(7,"button",12),e.NdJ("click",function(){return e.CHM(l),e.oxw().startUpload()}),e._uU(8,"Import"),e.qZA()()}if(2&s){const l=e.oxw();e.xp6(1),e.Q6J("options",l.options)("uploadInput",l.uploadInput)("ngClass",e.VKq(6,C,l.dragOver)),e.xp6(2),e.Q6J("options",l.options)("uploadInput",l.uploadInput),e.xp6(3),e.Q6J("ngIf",l.files[0])}}function F(s,o){if(1&s&&(e.TgZ(0,"div",2)(1,"div",13)(2,"p"),e._uU(3),e.qZA()()()),2&s){const l=e.oxw();e.xp6(3),e.hij("Please wait while the ",l.files[0].name," is being imported.")}}function u(s,o){if(1&s&&(e.TgZ(0,"div")(1,"p",18),e._UZ(2,"nb-icon",19),e.TgZ(3,"span"),e._uU(4),e.qZA()()()),2&s){const l=o.$implicit;e.xp6(4),e.Oqu(l)}}function n(s,o){1&s&&(e.TgZ(0,"button",20),e._uU(1,"Confirm"),e.qZA())}function t(s,o){if(1&s){const l=e.EpF();e.TgZ(0,"div",14)(1,"div",13),e.YNc(2,u,5,1,"div",15),e.TgZ(3,"div",16)(4,"button",12),e.NdJ("click",function(){return e.CHM(l),e.oxw().onCloseDialog()}),e._uU(5,"Cancel"),e.qZA(),e.YNc(6,n,2,0,"button",17),e.qZA()()()}if(2&s){const l=e.oxw();e.xp6(2),e.Q6J("ngForOf",l.messages),e.xp6(4),e.Q6J("ngIf",!l.serverError)}}let i=class{constructor(o,l){this.dialog=o,this.api=l,this.uploadStarted=!1,this.importStarted=!1,this.noUpload=!0,this.uploadResult={},this.importResult={},this.messages=[],this.serverError=!1,this.options={concurrency:1,maxUploads:3,maxFileSize:1e9},this.files=[],this.uploadInput=new e.vpe,this.humanizeBytes=g.kK}onUploadOutput(o){switch(o.type){case"allAddedToQueue":case"addedToQueue":case"uploading":void 0!==o.file&&(this.files[0]=o.file);break;case"removed":this.files=[];break;case"dragOver":this.dragOver=!0;break;case"dragOut":case"drop":this.dragOver=!1}}startUpload(){this.uploadStarted=!0,this.noUpload=!1,this.file=this.files[0].nativeFile,this.file&&this.api.dataImportUploadFilePost([this.file]).pipe((0,c.t)(this)).subscribe({next:o=>{this.uploadStarted=!1,this.uploadResult=o},error:o=>{console.log(o),this.uploadStarted=!1,500===o.status?(this.serverError=!0,this.messages.push("Someting went wrong")):this.messages.push(o.message)}})}onCloseDialog(){this.dialog.close()}};i.\u0275fac=function(o){return new(o||i)(e.Y36(r.X4l),e.Y36(h.kt))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-import-csv-dialog"]],decls:10,vars:4,consts:[["nbSpinnerStatus","basic",3,"nbSpinner"],["icon","close",1,"import-dialog-close",3,"click"],[1,"upload-box"],["class","upload-box-content",4,"ngIf"],["class","upload-box",4,"ngIf"],["class","upload-box upload-errors",4,"ngIf"],[1,"upload-box-content"],["ngFileDrop","",1,"drop-container",3,"options","uploadInput","ngClass","uploadOutput"],[1,"upload-button"],["type","file","ngFileSelect","",3,"options","uploadInput","uploadOutput"],["icon","add_circle",1,"import-csv-icon"],[4,"ngIf"],["nbButton","","status","primary","size","medium",3,"click"],[1,"upload-box-inner"],[1,"upload-box","upload-errors"],[4,"ngFor","ngForOf"],[1,"buttons"],["nbButton","","status","primary","size","medium",4,"ngIf"],[1,"upload-error"],["icon","warning"],["nbButton","","status","primary","size","medium"]],template:function(o,l){1&o&&(e.TgZ(0,"nb-card",0)(1,"nb-card-header")(2,"h2"),e._uU(3,"Import CSV"),e.qZA(),e.TgZ(4,"nb-icon",1),e.NdJ("click",function(){return l.onCloseDialog()}),e.qZA()(),e.TgZ(5,"nb-card-body")(6,"div",2),e.YNc(7,M,9,8,"div",3),e.YNc(8,F,4,1,"div",4),e.YNc(9,t,7,2,"div",5),e.qZA()()()),2&o&&(e.Q6J("nbSpinner",l.uploadStarted),e.xp6(7),e.Q6J("ngIf",l.noUpload),e.xp6(1),e.Q6J("ngIf",l.uploadStarted),e.xp6(1),e.Q6J("ngIf",l.messages.length>0))},directives:[r.Asz,r.Q7R,r.ndF,r.fMN,r.yKW,_.O5,g.LU,_.mk,g.qx,r.DPz,_.sg],styles:["nb-card-header[_ngcontent-%COMP%]{position:relative}.import-dialog-close[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;cursor:pointer}.upload-box[_ngcontent-%COMP%]{width:100%;height:auto;display:inline-block;border-radius:10px;min-height:100px}.upload-box-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.drop-container[_ngcontent-%COMP%], .upload-item[_ngcontent-%COMP%]{width:100%;width:527px;height:127px;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' stroke='white' stroke-width='2' stroke-dasharray='5' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e\");padding:20px;display:inline-block}.drop-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;margin-bottom:15px}.upload-button[_ngcontent-%COMP%]{display:flex;align-items:center;border:none;outline:0;cursor:pointer;font-size:20px;padding:0 2px}.import-csv-icon[_ngcontent-%COMP%]{margin-right:15px}.upload-button[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.upload-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 30px}.upload-item-content[_ngcontent-%COMP%]{width:100%}.upload-error[_ngcontent-%COMP%]{display:flex}.upload-error[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:15px}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:48px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 17px}"]}),i=(0,p.gn)([(0,c.c)()],i)},5942:(O,f,a)=>{a.d(f,{vP:()=>h}),a(5538);var e=a(9808),g=a(6913),c=a(6781),r=a(5e3);let h=(()=>{class v{}return v.\u0275fac=function(M){return new(M||v)},v.\u0275mod=r.oAB({type:v}),v.\u0275inj=r.cJS({imports:[[e.ez,g.TA,c.T2N,c.zyh,c.KdK,c.uuI]]}),v})();a(6526)},6460:(O,f,a)=>{a.d(f,{n:()=>c});var p=a(9808),e=a(6781),g=a(5e3);let c=(()=>{class r{}return r.\u0275fac=function(_){return new(_||r)},r.\u0275mod=g.oAB({type:r}),r.\u0275inj=g.cJS({imports:[[p.ez,e.nKr,e.KdK]]}),r})()},4362:(O,f,a)=>{a.d(f,{m:()=>e});var p=a(5e3);let e=(()=>{class g{constructor(r){this.element=r,this.editableClass=!0,this._appEditable=!1,this.appEditableManual=!1}get editableActiveClass(){return this.appEditable}get readonly(){return!this.appEditable}set appEditable(r){void 0===r||"string"==typeof r||this._appEditable===r||(this._appEditable=r)}get appEditable(){return this._appEditable}onClick(r){this._appEditable||r.stopPropagation()}onDoubleClick(){this.appEditableManual||(this.appEditable=!0)}onBlur(){this.element.nativeElement.classList.contains("open")||this.appEditableManual||!this._appEditable||(this.appEditable=!1)}}return g.\u0275fac=function(r){return new(r||g)(p.Y36(p.SBq))},g.\u0275dir=p.lG2({type:g,selectors:[["","appEditable",""]],hostVars:5,hostBindings:function(r,h){1&r&&p.NdJ("click",function(v){return h.onClick(v)})("dblclick",function(){return h.onDoubleClick()})("focusout",function(){return h.onBlur()}),2&r&&(p.Ikx("readonly",h.readonly),p.ekj("editable",h.editableClass)("editable-active",h.editableActiveClass))},inputs:{appEditable:"appEditable",appEditableManual:"appEditableManual"}}),g})()},2601:(O,f,a)=>{a.d(f,{r:()=>g});var p=a(9808),e=a(5e3);let g=(()=>{class c{}return c.\u0275fac=function(h){return new(h||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({imports:[[p.ez]]}),c})()},5173:(O,f,a)=>{a.d(f,{i:()=>g});var p=a(9808),e=a(5e3);let g=(()=>{class c{}return c.\u0275fac=function(h){return new(h||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({imports:[[p.ez]]}),c})()},6913:(O,f,a)=>{a.d(f,{LU:()=>C,qx:()=>M,TA:()=>F,kK:()=>_});var p=a(5e3),e=a(8929),g=a(2916),c=a(1709),r=a(537),h=(()=>{return(u=h||(h={}))[u.Queue=0]="Queue",u[u.Uploading=1]="Uploading",u[u.Done=2]="Done",u[u.Cancelled=3]="Cancelled",h;var u})();function _(u){if(0===u)return"0 Byte";const i=Math.floor(Math.log(u)/Math.log(1024));return parseFloat((u/Math.pow(1024,i)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][i]}class v{constructor(n=Number.POSITIVE_INFINITY,t=["*"],i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY){this.queue=[],this.serviceEvents=new p.vpe,this.uploadScheduler=new e.xQ,this.subs=[],this.contentTypes=t,this.maxUploads=i,this.maxFileSize=s,this.uploadScheduler.pipe((0,c.zg)(o=>this.startUpload(o),n)).subscribe(o=>this.serviceEvents.emit(o))}handleFiles(n){const t=[].reduce.call(n,(i,s,o)=>{const l=i.length+this.queue.length+1;if(this.isContentTypeAllowed(s.type)&&l<=this.maxUploads&&this.isFileSizeAllowed(s.size))i=i.concat(s);else{const E=this.makeUploadFile(s,o);this.serviceEvents.emit({type:"rejected",file:E})}return i},[]);this.queue.push(...[].map.call(t,(i,s)=>{const o=this.makeUploadFile(i,s);return this.serviceEvents.emit({type:"addedToQueue",file:o}),o})),this.serviceEvents.emit({type:"allAddedToQueue"})}initInputEvents(n){return n.subscribe(t=>{switch(t.type){case"uploadFile":const i=this.queue.findIndex(d=>d===t.file);-1!==i&&t.file&&this.uploadScheduler.next({file:this.queue[i],event:t});break;case"uploadAll":this.queue.filter(d=>d.progress.status===h.Queue).forEach(d=>this.uploadScheduler.next({file:d,event:t}));break;case"cancel":const o=t.id||null;if(!o)return;this.subs.filter(d=>d.id===o).forEach(d=>{if(d.sub){d.sub.unsubscribe();const I=this.queue.findIndex(b=>b.id===o);-1!==I&&(this.queue[I].progress.status=h.Cancelled,this.serviceEvents.emit({type:"cancelled",file:this.queue[I]}))}});break;case"cancelAll":this.subs.forEach(d=>{d.sub&&d.sub.unsubscribe();const I=this.queue.find(b=>b.id===d.id);I&&(I.progress.status=h.Cancelled,this.serviceEvents.emit({type:"cancelled",file:I}))});break;case"remove":if(!t.id)return;const E=this.queue.findIndex(d=>d.id===t.id);if(-1!==E){const d=this.queue[E];this.queue.splice(E,1),this.serviceEvents.emit({type:"removed",file:d})}break;case"removeAll":this.queue.length&&(this.queue=[],this.serviceEvents.emit({type:"removedAll"}))}})}startUpload(n){return new g.y(t=>{const i=this.uploadFile(n.file,n.event).pipe((0,r.x)(()=>{t.closed||t.complete()})).subscribe(s=>{t.next(s)},s=>{t.error(s),t.complete()},()=>{t.complete()});this.subs.push({id:n.file.id,sub:i})})}uploadFile(n,t){return new g.y(i=>{const s=t.url||"",o=t.method||"POST",l=t.data||{},E=t.headers||{},d=new XMLHttpRequest,I=(new Date).getTime();let b=n.progress.data&&n.progress.data.startTime||I,y=0,x=null;d.upload.addEventListener("progress",m=>{if(m.lengthComputable){const P=Math.round(100*m.loaded/m.total),T=(new Date).getTime()-I;y=Math.round(m.loaded/T*1e3),b=n.progress.data&&n.progress.data.startTime||(new Date).getTime(),x=Math.ceil((m.total-m.loaded)/y),n.progress={status:h.Uploading,data:{percentage:P,speed:y,speedHuman:`${_(y)}/s`,startTime:b,endTime:null,eta:x,etaHuman:this.secondsToHuman(x)}},i.next({type:"uploading",file:n})}},!1),d.upload.addEventListener("error",m=>{i.error(m),i.complete()}),d.onreadystatechange=()=>{if(d.readyState===XMLHttpRequest.DONE){const m=Math.round(n.size/((new Date).getTime()-b)*1e3);n.progress={status:h.Done,data:{percentage:100,speed:m,speedHuman:`${_(m)}/s`,startTime:b,endTime:(new Date).getTime(),eta:x,etaHuman:this.secondsToHuman(x||0)}},n.responseStatus=d.status;try{n.response=JSON.parse(d.response)}catch(P){n.response=d.response}n.responseHeaders=this.parseResponseHeaders(d.getAllResponseHeaders()),i.next({type:"done",file:n}),i.complete()}},d.open(o,s,!0),d.withCredentials=!!t.withCredentials;try{const m=n.nativeFile,P=this.queue.findIndex(D=>D.nativeFile===m);let T;this.queue[P].progress.status===h.Cancelled&&i.complete(),Object.keys(E).forEach(D=>d.setRequestHeader(D,E[D])),!1!==t.includeWebKitFormBoundary?(Object.keys(l).forEach(D=>n.form.append(D,l[D])),n.form.append(t.fieldName||"file",m,m.name),T=n.form):T=m,this.serviceEvents.emit({type:"start",file:n}),d.send(T)}catch(m){i.complete()}return()=>{d.abort()}})}secondsToHuman(n){return new Date(1e3*n).toISOString().substr(11,8)}generateId(){return Math.random().toString(36).substring(7)}setContentTypes(n){this.contentTypes=void 0!==n&&n instanceof Array?void 0!==n.find(t=>"*"===t)?["*"]:n:["*"]}allContentTypesAllowed(){return void 0!==this.contentTypes.find(n=>"*"===n)}isContentTypeAllowed(n){return!!this.allContentTypesAllowed()||void 0!==this.contentTypes.find(t=>t===n)}isFileSizeAllowed(n){return!this.maxFileSize||n<=this.maxFileSize}makeUploadFile(n,t){return{fileIndex:t,id:this.generateId(),name:n.name,size:n.size,type:n.type,form:new FormData,progress:{status:h.Queue,data:{percentage:0,speed:0,speedHuman:`${_(0)}/s`,startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:new Date(n.lastModified),sub:void 0,nativeFile:n}}parseResponseHeaders(n){if(n)return n.split("\n").map(t=>t.split(/: */,2)).filter(t=>t[0]).reduce((t,i)=>(t[i[0]]=i[1],t),{})}}let C=(()=>{class u{constructor(t){this.elementRef=t,this.stopEvent=i=>{i.stopPropagation(),i.preventDefault()},this.uploadOutput=new p.vpe}ngOnInit(){this._sub=[],this.upload=new v(this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,this.options&&this.options.allowedContentTypes||["*"],this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY),this.el=this.elementRef.nativeElement,this._sub.push(this.upload.serviceEvents.subscribe(l=>{this.uploadOutput.emit(l)})),this.uploadInput instanceof p.vpe&&this._sub.push(this.upload.initInputEvents(this.uploadInput)),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)}ngOnDestroy(){this._sub.forEach(t=>t.unsubscribe())}onDrop(t){t.stopPropagation(),t.preventDefault(),this.uploadOutput.emit({type:"drop"}),this.upload.handleFiles(t.dataTransfer.files)}onDragOver(t){t&&this.uploadOutput.emit({type:"dragOver"})}onDragLeave(t){t&&this.uploadOutput.emit({type:"dragOut"})}}return u.\u0275fac=function(t){return new(t||u)(p.Y36(p.SBq))},u.\u0275dir=p.lG2({type:u,selectors:[["","ngFileDrop",""]],hostBindings:function(t,i){1&t&&p.NdJ("drop",function(o){return i.onDrop(o)})("dragover",function(o){return i.onDragOver(o)})("dragleave",function(o){return i.onDragLeave(o)})},inputs:{options:"options",uploadInput:"uploadInput"},outputs:{uploadOutput:"uploadOutput"}}),u})(),M=(()=>{class u{constructor(t){this.elementRef=t,this.fileListener=()=>{this.el.files&&this.upload.handleFiles(this.el.files)},this.uploadOutput=new p.vpe}ngOnInit(){this._sub=[],this.upload=new v(this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,this.options&&this.options.allowedContentTypes||["*"],this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this._sub.push(this.upload.serviceEvents.subscribe(l=>{this.uploadOutput.emit(l)})),this.uploadInput instanceof p.vpe&&this._sub.push(this.upload.initInputEvents(this.uploadInput))}ngOnDestroy(){this.el&&(this.el.removeEventListener("change",this.fileListener,!1),this._sub.forEach(t=>t.unsubscribe()))}}return u.\u0275fac=function(t){return new(t||u)(p.Y36(p.SBq))},u.\u0275dir=p.lG2({type:u,selectors:[["","ngFileSelect",""]],inputs:{options:"options",uploadInput:"uploadInput"},outputs:{uploadOutput:"uploadOutput"}}),u})(),F=(()=>{class u{}return u.\u0275fac=function(t){return new(t||u)},u.\u0275mod=p.oAB({type:u}),u.\u0275inj=p.cJS({}),u})()}}]);