"use strict";(self.webpackChunkechelon=self.webpackChunkechelon||[]).push([[705],{705:(Yt,S,f)=>{f.r(S),f.d(S,{SiteModule:()=>Qt});var h=f(9808),a=f(3075),l=f(9697),W=f(2601),t=f(5e3);let E=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[h.ez]]}),i})(),B=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[h.ez]]}),i})(),J=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[h.ez,l.KdK,a.u5,a.UX,l.IIj,l.nKr,l.zyh,l.T2N,l.uuI,W.r,l.rgH,l.LW9,l.COg,E,B]]}),i})();var C=f(655),p=f(4987),Z=f(567),I=f(2125),O=f(3242),N=f(1042),b=f(4694);function F(i,n){1&i&&(t.TgZ(0,"span",26),t._uU(1," This field is required "),t.qZA())}function U(i,n){1&i&&(t.TgZ(0,"span",26),t._uU(1," This field is required "),t.qZA())}function D(i,n){if(1&i&&(t.TgZ(0,"p",27),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",null!=e.workCenterBuffer&&e.workCenterBuffer.length?null==e.workCenterBuffer[0].bufferType?null:e.workCenterBuffer[0].bufferType.displayValue:"No buffer selected"," ")}}function P(i,n){if(1&i&&(t.TgZ(0,"nb-option",30),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.s9C("value",e.reference),t.xp6(1),t.Oqu(e.displayValue)}}function Q(i,n){if(1&i&&(t.TgZ(0,"nb-select",28),t.YNc(1,P,2,2,"nb-option",29),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("ngForOf",null==e.buffersTypes?null:e.buffersTypes.selectItems)}}function R(i,n){if(1&i&&t._UZ(0,"i",31),2&i){const e=t.oxw().$implicit,o=t.oxw(3);t.Q6J("nbTooltip",o.getWarningInfo(e.missingLinks))}}function Y(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",32),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).toggleEdit(r)}),t.qZA()}}const H=function(i){return{disabled:i}};function G(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",33),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).saveEdit(r)}),t.qZA()}if(2&i){const e=t.oxw().index,o=t.oxw(3);let r;t.Q6J("ngClass",t.VKq(1,H,null==(r=o.getControl(e).get("name"))?null:r.getError("required")))}}function M(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).cancelEdit(r)}),t.qZA()}}function L(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",35),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(),s=r.$implicit,c=r.index;return t.oxw(3).onDelete(s.uuid,c)}),t.qZA()}}function j(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"tr",12)(1,"td"),t._UZ(2,"input",13),t.YNc(3,F,2,0,"span",14),t.qZA(),t.TgZ(4,"td"),t._UZ(5,"input",15),t.YNc(6,U,2,0,"span",14),t.qZA(),t.TgZ(7,"td"),t.YNc(8,D,2,1,"p",16),t.YNc(9,Q,2,1,"nb-select",17),t.qZA(),t.TgZ(10,"td"),t._UZ(11,"input",18),t.qZA(),t.TgZ(12,"td")(13,"i",19),t.NdJ("click",function(){const r=t.CHM(e),s=r.$implicit,c=r.index;return t.oxw(3).onOpenConnectionPopup(s,c)}),t.qZA()(),t.TgZ(14,"td")(15,"div",20),t.YNc(16,R,1,1,"i",21),t.YNc(17,Y,1,0,"i",22),t.YNc(18,G,1,3,"i",23),t.YNc(19,M,1,0,"i",24),t.YNc(20,L,1,0,"i",25),t.qZA()(),t._UZ(21,"td"),t.qZA()}if(2&i){const e=n.$implicit,o=n.index,r=t.oxw(3);let s,c,u,d;t.Q6J("formGroupName",o),t.xp6(2),t.s9C("id",e.name),t.s9C("value",e.name),t.xp6(1),t.Q6J("ngIf",(null==(s=r.getControl(o).get("name"))?null:s.touched)&&(null==(s=r.getControl(o).get("name"))?null:s.getError("required"))),t.xp6(2),t.s9C("id",e.nameShort),t.s9C("value",e.nameShort),t.xp6(1),t.Q6J("ngIf",(null==(c=r.getControl(o).get("nameShort"))?null:c.touched)&&(null==(c=r.getControl(o).get("nameShort"))?null:c.getError("required"))),t.xp6(2),t.Q6J("ngIf",null==(u=r.getControl(o).get("bufferType"))?null:u.disabled),t.xp6(1),t.Q6J("ngIf",!(null!=(d=r.getControl(o).get("bufferType"))&&d.disabled)),t.xp6(2),t.s9C("value",e.workCenterBuffer?null==e.workCenterBuffer[0]?null:e.workCenterBuffer[0].capacity:0),t.xp6(5),t.Q6J("ngIf","Warning"===e.linkStatus||"Critical"===e.linkStatus),t.xp6(1),t.Q6J("ngIf",r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",!r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",!r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",r.formControlState(o))}}function z(i,n){if(1&i&&(t.ynx(0),t.YNc(1,j,22,15,"tr",11),t.BQk()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.workcenters)}}function V(i,n){1&i&&(t.TgZ(0,"tr")(1,"td",36),t._uU(2,"There are no workcenters to display."),t.qZA()())}function $(i,n){if(1&i&&(t.TgZ(0,"tr",37),t._UZ(1,"td",38),t.qZA()),2&i){const e=t.oxw(2);t.Q6J("nbSpinner",e.isLoading)}}function X(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"th",3),t._uU(6,"Name Short"),t.qZA(),t.TgZ(7,"th",3),t._uU(8,"Buffer type"),t.qZA(),t.TgZ(9,"th",3),t._uU(10,"Capacity"),t.qZA(),t.TgZ(11,"th",3),t._uU(12,"Connections"),t.qZA(),t.TgZ(13,"th",4),t._uU(14,"Actions"),t.qZA(),t.TgZ(15,"th",3)(16,"div",5)(17,"nb-icon",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.qZA()()()()(),t.TgZ(18,"tbody",7),t.YNc(19,z,2,1,"ng-container",8),t.YNc(20,V,3,0,"ng-template",null,9,t.W1O),t.YNc(22,$,2,1,"tr",10),t.qZA()()}if(2&i){const e=t.MAs(21),o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(18),t.Q6J("formArrayName","formArrayName"),t.xp6(1),t.Q6J("ngIf",null==o.workcenters?null:o.workcenters.length)("ngIfElse",e),t.xp6(3),t.Q6J("ngIf",o.maxPages>=o.currentDataPage)}}let T=class{constructor(n,e,o,r,s,c,u,d){this.bufferTypeApi=n,this.workstationApi=e,this.workcenterApi=o,this.activityApi=r,this.cdr=s,this.formBuilder=c,this.dialog=u,this.toastrService=d,this.dataAvailable=!1,this.currentDataPage=1,this.maxPages=1,this.isLoading=!1,this.workstations=[],this.activities=[],this.editable=!1,this.positions=l.fe3,this.reloadData="",this.editItem=new t.vpe,this.removeItem=new t.vpe,this.addNewItem=new t.vpe,this.form=new a.cw({formArrayName:this.formBuilder.array([])})}ngOnInit(){this.findData()}getBuffersType(){}buildForm(){this.form=this.formBuilder.group({formArrayName:this.formBuilder.array(this.workcenters.map(n=>{var e,o,r,s,c,u;return this.createWorkcenterGroup(!!n.uuid,null!==(e=n.name)&&void 0!==e?e:"",null!==(o=n.nameShort)&&void 0!==o?o:"",null!==(r=n.uuid)&&void 0!==r?r:"",n.workCenterBuffer?null===(c=null===(s=n.workCenterBuffer[0])||void 0===s?void 0:s.bufferType)||void 0===c?void 0:c.reference:"",n.workCenterBuffer?null===(u=n.workCenterBuffer[0])||void 0===u?void 0:u.capacity:0)}))})}createWorkcenterGroup(n=!0,e="",o="",r="",s="",c=0){return this.formBuilder.group({name:new a.NI({value:e,disabled:n},a.kI.required),nameShort:new a.NI({value:o,disabled:n},a.kI.required),uuid:new a.NI({value:r,disabled:n}),bufferType:new a.NI({value:s,disabled:n}),capacity:new a.NI({value:c,disabled:n})})}onAdd(){var n,e;null===(n=this.workcenters)||void 0===n||n.splice(0,0,{}),this.workcenters=[...null!==(e=this.workcenters)&&void 0!==e?e:[]];const o=this.form.get("formArrayName"),r=this.formBuilder.group({name:new a.NI({value:"",disabled:!1},a.kI.required),nameShort:new a.NI({value:"",disabled:!1},a.kI.required),uuid:new a.NI({value:"",disabled:!1}),bufferType:new a.NI({value:"",disabled:!1}),capacity:new a.NI({value:"",disabled:!1})});null==o||o.insert(0,r),this.cdr.markForCheck()}onRemove(n){var e;null===(e=this.workcenters)||void 0===e||e.splice(n,1),this.form.get("formArrayName").removeAt(n),this.cdr.markForCheck()}onOpenConnectionPopup(n,e){var o,r,s;const c=this.dialog.open(O.w);c.onBackdropClick.pipe((0,p.t)(this)).subscribe(()=>{c.close()});const u=this.workcenters[e];if(!(null===(o=this.workstations)||void 0===o?void 0:o.length)||!u)return;const d=(null===(r=null==u?void 0:u.workstations)||void 0===r?void 0:r.length)?this.workstations.filter(_=>{var m;return!(null===(m=null==u?void 0:u.workstations)||void 0===m?void 0:m.find(g=>g.reference===_.reference))}):[...this.workstations];c.componentRef.instance.items=d,c.componentRef.instance.selectedItems=null!==(s=null==u?void 0:u.workstations)&&void 0!==s?s:[],c.componentRef.instance.leftTitle="Workstations",c.componentRef.instance.rightTitle=`Workcenter: ${n.name}`,c.componentRef.instance.title="Connect a Workstation to the Workcenter",c.componentRef.instance.completed.pipe((0,p.t)(this)).subscribe(_=>{u.workstations=_,c.close(),this.saveEdit(e)})}onDelete(n,e){const o=this.dialog.open(I.D);o.componentRef.instance.title="Remove workcenter",o.componentRef.instance.text="Are you sure you want to remove this workcenter?",o.onBackdropClick.pipe((0,p.t)(this)).subscribe(()=>{o.close()}),o.componentRef.instance.completed.pipe((0,p.t)(this)).subscribe(r=>{n?this.workcenterApi.dataWorkCenterDeleteUuidDelete(n).pipe((0,p.t)(this)).subscribe({next:()=>{this.onRemove(e),this.cdr.markForCheck(),o.close(),this.showToast(this.positions.TOP_RIGHT,"success","Workcenter succesfully removed.",3e3)},error:()=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}}):(this.onRemove(e),o.close())})}saveEdit(n){var e,o;const s=this.form.get("formArrayName").controls[n],u={bufferType:null===(o=null===(e=this.buffersTypes)||void 0===e?void 0:e.selectItems)||void 0===o?void 0:o.find(g=>g.reference===s.value.bufferType),capacity:s.value.capacity},_={name:s.value.name,nameShort:s.value.nameShort,workCenterBuffer:[u],workstations:this.workcenters[n].workstations},m=s.value.uuid;m?(_.uuid=m,this.workcenterApi.dataWorkCenterUpdateUuidPut(m,_).pipe((0,p.t)(this)).subscribe(g=>{var v;const A=null===(v=this.workcenters)||void 0===v?void 0:v.findIndex(Rt=>Rt.uuid===m);this.workcenters[A].name=_.name,this.workcenters[A].nameShort=_.nameShort,this.workcenters[A].workCenterBuffer=_.workCenterBuffer,this.workcenters[A].workstations=_.workstations,this.showToast(this.positions.TOP_RIGHT,"success","Workcenter succesfully updated.",3e3),this.cdr.markForCheck()},g=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)})):(_.uuid=(0,N.Z)(),this.workcenterApi.dataWorkCenterCreatePost(_).pipe((0,p.t)(this)).subscribe(g=>{this.workcenters[0]=_,this.showToast(this.positions.TOP_RIGHT,"success","Workcenter succesfully created.",3e3)},g=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)})),this.toggleEdit(n)}toggleEdit(n){const e=this.form.get("formArrayName");"DISABLED"===e.controls[n].status?e.controls[n].enable():e.controls[n].disable()}getControl(n){return this.form.get("formArrayName").controls[n]}cancelEdit(n){var e;this.toggleEdit(n);const o=this.form.get("formArrayName"),r=null===(e=this.workcenters)||void 0===e?void 0:e.find(s=>s.uuid===o.controls[n].value.uuid);o.controls[n].patchValue({name:null==r?void 0:r.name,nameShort:null==r?void 0:r.nameShort})}formControlState(n){return this.form.get("formArrayName").controls[n].disabled}getControlsArray(){return this.form.get("formArrayName")}findData(){(0,Z.D)(this.workstationApi.dataWorkstationAllWorkstationsGet(),this.bufferTypeApi.dataBufferTypeAllBufferTypesGet(),this.workcenterApi.dataWorkCenterListGet()).pipe((0,p.t)(this)).subscribe({next:([n,e,o])=>{this.workcenters=o.items,this.workcentersResponse=o,this.maxPages=o.totalPages,this.workstations=n.selectItems,this.buffersTypes=e,this.dataAvailable=!0,this.buildForm(),this.cdr.markForCheck(),this.showToast(this.positions.TOP_RIGHT,"danger",this.createToastMessage())}})}createToastMessage(){var n;const e=[];return null===(n=this.workcenters)||void 0===n||n.forEach(o=>{var r;(null===(r=null==o?void 0:o.missingLinks)||void 0===r?void 0:r.length)&&e.push(o.name)}),e.length?`${e.join(", ")} workcenters has no workstation or buffer connection.`:""}getWarningInfo(n){const e=null==n?void 0:n.map(o=>o.displayValue).join(". ");return null!=e?e:""}showToast(n,e,o,r=5e3,s=""){!o||this.toastrService.show(e||"Success",o,{icon:s,position:n,status:e,duration:r,destroyByClick:!0,limit:1})}checkIfScrolledToBottom(){const n=document.getElementById("workcenters-table-list");(null==n?void 0:n.scrollTop)-((null==n?void 0:n.scrollHeight)-(null==n?void 0:n.clientHeight))>-20&&(this.currentDataPage++,this.getNextPage())}getNextPage(){this.maxPages>=this.currentDataPage&&(this.isLoading=!0,this.workcenterApi.dataWorkCenterListGet(void 0,void 0,this.currentDataPage.toString(),void 0,"response").subscribe(n=>{this.workcenters.push(...n.body.items),this.workcenters=this.workcenters.filter((e,o,r)=>o===r.findIndex(s=>s.uuid===e.uuid)),this.isLoading=!1,this.buildForm(),this.cdr.detectChanges()}))}};function K(i,n){1&i&&(t.TgZ(0,"span",28),t._uU(1," This field is required "),t.qZA())}function tt(i,n){1&i&&(t.TgZ(0,"span",28),t._uU(1," This field is required "),t.qZA())}function et(i,n){if(1&i&&(t.TgZ(0,"nb-option",29),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.s9C("value",e.reference),t.xp6(1),t.Oqu(e.displayValue)}}function nt(i,n){if(1&i&&(t.TgZ(0,"nb-option",29),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.s9C("value",e.reference),t.xp6(1),t.Oqu(e.displayValue)}}function ot(i,n){if(1&i&&(t.TgZ(0,"nb-option",29),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.s9C("value",e.reference),t.xp6(1),t.Oqu(e.displayValue)}}function it(i,n){if(1&i&&t._UZ(0,"i",30),2&i){const e=t.oxw().$implicit,o=t.oxw(3);t.Q6J("nbTooltip",o.getWarningInfo(e.missingLinks))}}function rt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",31),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).toggleEdit(r)}),t.qZA()}}T.\u0275fac=function(n){return new(n||T)(t.Y36(b.jg),t.Y36(b.F),t.Y36(b.Uv),t.Y36(b.B0),t.Y36(t.sBO),t.Y36(a.qu),t.Y36(l.Gln),t.Y36(l.quB))},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-workcenter-table"]],inputs:{reloadData:"reloadData"},outputs:{editItem:"editItem",removeItem:"removeItem",addNewItem:"addNewItem"},decls:2,vars:2,consts:[["id","workcenters-table-list",1,"spinner-wrapper","table-container","table-fixed-header",3,"nbSpinner","scroll"],["class","table",3,"formGroup",4,"ngIf"],[1,"table",3,"formGroup"],["scope","col"],["scope","col text-right"],[1,"float-right"],["title","Create","icon","add_circle",1,"add-icon",3,"click"],[3,"formArrayName"],[4,"ngIf","ngIfElse"],["noData",""],[3,"nbSpinner",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["status","primary","nbInput","","type","text","formControlName","name",1,"editable-input",3,"id","value"],["class","text-danger",4,"ngIf"],["status","primary","nbInput","","type","text","formControlName","nameShort",1,"editable-input",3,"id","value"],["class","buffer-p",4,"ngIf"],["fullWidth","","status","control","placeholder","Buffer type","class","select editable-input","formControlName","bufferType",4,"ngIf"],["status","primary","nbInput","","type","number","formControlName","capacity",1,"editable-input",3,"value"],[1,"iconEcheclon","icon-connection",3,"click"],[1,"float-right","icons-wrapper"],["class","iconEcheclon icon-warning_red cursor-pointer mr-3",3,"nbTooltip",4,"ngIf"],["class","iconEcheclon icon-edit cursor-pointer mr-1",3,"click",4,"ngIf"],["class","iconEcheclon icon-confirm cursor-pointer mr-1",3,"ngClass","click",4,"ngIf"],["class","iconEcheclon icon-close cursor-pointer",3,"click",4,"ngIf"],["class","iconEcheclon icon-bin cursor-pointer",3,"click",4,"ngIf"],[1,"text-danger"],[1,"buffer-p"],["fullWidth","","status","control","placeholder","Buffer type","formControlName","bufferType",1,"select","editable-input"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"iconEcheclon","icon-warning_red","cursor-pointer","mr-3",3,"nbTooltip"],[1,"iconEcheclon","icon-edit","cursor-pointer","mr-1",3,"click"],[1,"iconEcheclon","icon-confirm","cursor-pointer","mr-1",3,"ngClass","click"],[1,"iconEcheclon","icon-close","cursor-pointer",3,"click"],[1,"iconEcheclon","icon-bin","cursor-pointer",3,"click"],["colspan","8",1,"border-0","text-center"],[3,"nbSpinner"],["colspan","8",1,"spinner-cell"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0),t.NdJ("scroll",function(){return e.checkIfScrolledToBottom()}),t.YNc(1,X,23,5,"table",1),t.qZA()),2&n&&(t.Q6J("nbSpinner",!e.dataAvailable),t.xp6(1),t.Q6J("ngIf",e.dataAvailable))},directives:[l.Q7R,h.O5,a.JL,a.sg,l.fMN,a.CE,h.sg,a.x0,l.h8i,a.Fj,a.JJ,a.u,l.rs,l.q51,a.wV,l.jNv,h.mk],styles:[".table-container[_ngcontent-%COMP%]{max-height:60vh;overflow:scroll}.buffer-p[_ngcontent-%COMP%]{min-width:150px}"],changeDetection:0}),T=(0,C.gn)([(0,p.c)()],T);const st=function(i){return{disabled:i}};function at(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",32),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).saveEdit(r)}),t.qZA()}if(2&i){const e=t.oxw().index,o=t.oxw(3);let r;t.Q6J("ngClass",t.VKq(1,st,null==(r=o.getControl(e).get("name"))?null:r.getError("required")))}}function ct(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",33),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).cancelEdit(r)}),t.qZA()}}function lt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(),s=r.$implicit,c=r.index;return t.oxw(3).onDelete(s.uuid,c)}),t.qZA()}}function ut(i,n){if(1&i&&(t.TgZ(0,"tr",12)(1,"td"),t._UZ(2,"input",13),t.YNc(3,K,2,0,"span",14),t.qZA(),t.TgZ(4,"td"),t._UZ(5,"input",15),t.YNc(6,tt,2,0,"span",14),t.qZA(),t.TgZ(7,"td"),t._UZ(8,"input",16),t.qZA(),t.TgZ(9,"td")(10,"nb-select",17),t.YNc(11,et,2,2,"nb-option",18),t.qZA()(),t.TgZ(12,"td"),t._UZ(13,"input",19),t.qZA(),t.TgZ(14,"td")(15,"nb-select",20),t.YNc(16,nt,2,2,"nb-option",18),t.qZA()(),t.TgZ(17,"td")(18,"nb-select",21),t.YNc(19,ot,2,2,"nb-option",18),t.qZA()(),t.TgZ(20,"td")(21,"div",22),t.YNc(22,it,1,1,"i",23),t.YNc(23,rt,1,0,"i",24),t.YNc(24,at,1,3,"i",25),t.YNc(25,ct,1,0,"i",26),t.YNc(26,lt,1,0,"i",27),t.qZA()(),t._UZ(27,"td"),t.qZA()),2&i){const e=n.$implicit,o=n.index,r=t.oxw(3);let s,c;t.Q6J("formGroupName",o),t.xp6(2),t.s9C("id",e.name),t.s9C("value",e.name),t.xp6(1),t.Q6J("ngIf",(null==(s=r.getControl(o).get("name"))?null:s.touched)&&(null==(s=r.getControl(o).get("name"))?null:s.getError("required"))),t.xp6(2),t.s9C("id",e.nameShort),t.s9C("value",e.nameShort),t.xp6(1),t.Q6J("ngIf",(null==(c=r.getControl(o).get("nameShort"))?null:c.touched)&&(null==(c=r.getControl(o).get("nameShort"))?null:c.getError("required"))),t.xp6(2),t.s9C("id",e.amountOfWorkstations),t.s9C("value",e.amountOfWorkstations),t.xp6(3),t.Q6J("ngForOf",null==r.buffersTypes?null:r.buffersTypes.selectItems),t.xp6(2),t.s9C("value",e.workStationBuffers?null==e.workStationBuffers[0]?null:e.workStationBuffers[0].capacity:0),t.xp6(3),t.Q6J("ngForOf",r.activities),t.xp6(3),t.Q6J("ngForOf",r.workcenters),t.xp6(3),t.Q6J("ngIf","Warning"===e.linkStatus||"Critical"===e.linkStatus),t.xp6(1),t.Q6J("ngIf",r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",!r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",!r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",r.formControlState(o))}}function dt(i,n){if(1&i&&(t.ynx(0),t.YNc(1,ut,28,18,"tr",11),t.BQk()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.workstations)}}function pt(i,n){1&i&&(t.TgZ(0,"tr")(1,"td",35),t._uU(2,"There are no workstations to display."),t.qZA()())}function _t(i,n){if(1&i&&(t.TgZ(0,"tr",36),t._UZ(1,"td",37),t.qZA()),2&i){const e=t.oxw(2);t.Q6J("nbSpinner",e.isLoading)}}function mt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"th",3),t._uU(6,"Name Short"),t.qZA(),t.TgZ(7,"th",3),t._uU(8,"Amount of workstations"),t.qZA(),t.TgZ(9,"th",3),t._uU(10,"Buffer type"),t.qZA(),t.TgZ(11,"th",3),t._uU(12,"Buffer Capacity"),t.qZA(),t.TgZ(13,"th",3),t._uU(14,"Activity"),t.qZA(),t.TgZ(15,"th",3),t._uU(16,"Workcenter"),t.qZA(),t.TgZ(17,"th",4),t._uU(18,"Actions"),t.qZA(),t.TgZ(19,"th",3)(20,"div",5)(21,"nb-icon",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.qZA()()()()(),t.TgZ(22,"tbody",7),t.YNc(23,dt,2,1,"ng-container",8),t.YNc(24,pt,3,0,"ng-template",null,9,t.W1O),t.YNc(26,_t,2,1,"tr",10),t.qZA()()}if(2&i){const e=t.MAs(25),o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(22),t.Q6J("formArrayName","formArrayName"),t.xp6(1),t.Q6J("ngIf",null==o.workstations?null:o.workstations.length)("ngIfElse",e),t.xp6(3),t.Q6J("ngIf",o.maxPages>=o.currentDataPage)}}let k=class{constructor(n,e,o,r,s,c,u,d){this.bufferTypeApi=n,this.workstationApi=e,this.workcenterApi=o,this.activityApi=r,this.cdr=s,this.formBuilder=c,this.dialog=u,this.toastrService=d,this.dataAvailable=!1,this.currentDataPage=1,this.maxPages=1,this.isLoading=!1,this.workcenters=[],this.activities=[],this.editable=!1,this.positions=l.fe3,this.reloadData="",this.editItem=new t.vpe,this.removeItem=new t.vpe,this.addNewItem=new t.vpe,this.form=new a.cw({formArrayName:this.formBuilder.array([])})}ngOnInit(){this.findData()}getBuffersType(){}buildForm(){this.form=this.formBuilder.group({formArrayName:this.formBuilder.array(this.workstations.map(n=>{var e,o,r,s,c,u,d,_,m,g,v;return this.createWorkstationGroup(!!n.uuid,null!==(e=n.name)&&void 0!==e?e:"",null!==(o=n.nameShort)&&void 0!==o?o:"",null!==(r=n.amountOfWorkstations)&&void 0!==r?r:0,null!==(s=n.uuid)&&void 0!==s?s:"",null!==(u=null===(c=n.activity)||void 0===c?void 0:c.reference)&&void 0!==u?u:"",null!==(_=null===(d=n.workCenter)||void 0===d?void 0:d.reference)&&void 0!==_?_:"",n.workStationBuffers?null===(g=null===(m=n.workStationBuffers[0])||void 0===m?void 0:m.bufferType)||void 0===g?void 0:g.reference:"",n.workStationBuffers?null===(v=n.workStationBuffers[0])||void 0===v?void 0:v.capacity:0)}))})}createWorkstationGroup(n=!0,e="",o="",r=0,s="",c="",u="",d="",_=0){return this.formBuilder.group({name:new a.NI({value:e,disabled:n},a.kI.required),nameShort:new a.NI({value:o,disabled:n},a.kI.required),amountOfWorkstations:new a.NI({value:r,disabled:n}),uuid:new a.NI({value:s,disabled:n}),activity:new a.NI({value:c,disabled:n}),workcenter:new a.NI({value:u,disabled:n}),bufferType:new a.NI({value:d,disabled:n}),capacity:new a.NI({value:_,disabled:n})})}onAdd(){var n;null===(n=this.workstations)||void 0===n||n.push({name:"",nameShort:"",amountOfWorkstations:0,activity:{},workCenter:{}}),this.buildForm(),this.cdr.markForCheck()}onRemove(n){var e;null===(e=this.workstations)||void 0===e||e.splice(n,1),this.form.get("formArrayName").removeAt(n),this.cdr.markForCheck()}onDelete(n,e){const o=this.dialog.open(I.D);o.componentRef.instance.title="Remove workstation",o.componentRef.instance.text="Are you sure you want to remove this workstation?",o.onBackdropClick.pipe((0,p.t)(this)).subscribe(()=>{o.close()}),o.componentRef.instance.completed.pipe((0,p.t)(this)).subscribe(r=>{n?this.workstationApi.dataWorkstationDeleteUuidDelete(n).pipe((0,p.t)(this)).subscribe({next:()=>{this.onRemove(e),this.cdr.markForCheck(),o.close(),this.showToast(this.positions.TOP_RIGHT,"success","Workstation succesfully removed.",3e3)},error:()=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}}):(this.onRemove(e),o.close())})}saveEdit(n){var e,o;const s=this.form.get("formArrayName").controls[n],u={bufferType:null===(o=null===(e=this.buffersTypes)||void 0===e?void 0:e.selectItems)||void 0===o?void 0:o.find(m=>m.reference===s.value.bufferType),capacity:s.value.capacity},d={name:s.value.name,nameShort:s.value.nameShort,amountOfWorkstations:s.value.amountOfWorkstations,workStationBuffers:[u],activity:this.getSelectedActivityObject(s.value.activity),workCenter:this.getSelectedWorkcenterObject(s.value.workcenter)},_=s.value.uuid;_?this.workstationApi.dataWorkstationUpdateUuidPut(_,d).pipe((0,p.t)(this)).subscribe(m=>{var g;let v=null===(g=this.workstations)||void 0===g?void 0:g.findIndex(A=>A.uuid===_);this.workstations[v].name=d.name,this.workstations[v].nameShort=d.nameShort,this.workstations[v].amountOfWorkstations=d.amountOfWorkstations,this.workstations[v].workStationBuffers=d.workStationBuffers,this.workstations[v].activity=d.activity,this.workstations[v].workCenter=d.workCenter,this.showToast(this.positions.TOP_RIGHT,"success","Workstation succesfully updated.",3e3)},m=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}):(d.uuid=(0,N.Z)(),this.workstationApi.dataWorkstationCreatePost(d).pipe((0,p.t)(this)).subscribe(m=>{this.workstations[this.workstations.length-1]=d,this.showToast(this.positions.TOP_RIGHT,"success","Workstation succesfully created.",3e3)},m=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)})),this.toggleEdit(n)}toggleEdit(n){const e=this.form.get("formArrayName");"DISABLED"===e.controls[n].status?e.controls[n].enable():e.controls[n].disable()}getControl(n){return this.form.get("formArrayName").controls[n]}cancelEdit(n){var e;this.toggleEdit(n);const o=this.form.get("formArrayName"),r=null===(e=this.workstations)||void 0===e?void 0:e.find(s=>s.uuid===o.controls[n].value.uuid);o.controls[n].patchValue({name:null==r?void 0:r.name,nameShort:null==r?void 0:r.nameShort,amountOfWorkstations:null==r?void 0:r.amountOfWorkstations})}formControlState(n){return this.form.get("formArrayName").controls[n].disabled}getControlsArray(){return this.form.get("formArrayName")}findData(){(0,Z.D)([this.workstationApi.dataWorkstationListGet(),this.bufferTypeApi.dataBufferTypeAllBufferTypesGet(),this.activityApi.dataActivityAllActivitiesGet(),this.workcenterApi.dataWorkCenterAllWorkCentersGet()]).pipe((0,p.t)(this)).subscribe({next:([n,e,o,r])=>{this.workcenters=r.selectItems,this.workstationsResponse=n,this.maxPages=n.totalPages,this.workstations=n.items,this.activities=o.selectItems,this.buffersTypes=e,this.dataAvailable=!0,this.buildForm(),this.cdr.markForCheck(),this.showToast(this.positions.TOP_RIGHT,"danger",this.createToastMessage(),3e3)}})}createToastMessage(){var n;const e=[];return null===(n=this.workstations)||void 0===n||n.forEach(o=>{var r;(null===(r=null==o?void 0:o.missingLinks)||void 0===r?void 0:r.length)&&e.push(o.name)}),e.length?`${e.join(", ")} workstations has no activity connection or workcenter connection or buffer connection.`:""}getWarningInfo(n){const e=null==n?void 0:n.map(o=>o.displayValue).join(". ");return null!=e?e:""}getSelectedActivityObject(n){var e;return(null===(e=this.activities)||void 0===e?void 0:e.filter(r=>r.reference===n)[0])||{}}getSelectedWorkcenterObject(n){var e;return(null===(e=this.workcenters)||void 0===e?void 0:e.filter(r=>r.reference===n)[0])||{}}showToast(n,e,o,r=3e3,s=""){!o||this.toastrService.show(e||"Success",o,{icon:s,position:n,status:e,duration:r,destroyByClick:!0})}checkIfScrolledToBottom(){const n=document.getElementById("workstations-table-list");(null==n?void 0:n.scrollTop)-((null==n?void 0:n.scrollHeight)-(null==n?void 0:n.clientHeight))>-20&&(this.currentDataPage++,this.getNextPage())}getNextPage(){this.maxPages>=this.currentDataPage&&(this.isLoading=!0,this.workstationApi.dataWorkstationListGet(void 0,void 0,this.currentDataPage.toString(),void 0,"response").subscribe(n=>{this.workstations=[...this.workstations,...n.body.items],this.workstations=this.workstations.filter((e,o,r)=>o===r.findIndex(s=>s.uuid===e.uuid)),this.isLoading=!1,this.buildForm(),this.cdr.detectChanges()}))}};k.\u0275fac=function(n){return new(n||k)(t.Y36(b.jg),t.Y36(b.F),t.Y36(b.Uv),t.Y36(b.B0),t.Y36(t.sBO),t.Y36(a.qu),t.Y36(l.Gln),t.Y36(l.quB))},k.\u0275cmp=t.Xpm({type:k,selectors:[["app-workstation-table"]],inputs:{reloadData:"reloadData"},outputs:{editItem:"editItem",removeItem:"removeItem",addNewItem:"addNewItem"},decls:3,vars:2,consts:[["id","workstations-table-list",1,"spinner-wrapper","table-container","table-fixed-header",3,"nbSpinner","scroll"],["class","table",3,"formGroup",4,"ngIf"],[1,"table",3,"formGroup"],["scope","col"],["scope","col text-right"],[1,"float-right"],["title","Create","icon","add_circle",3,"click"],[3,"formArrayName"],[4,"ngIf","ngIfElse"],["noData",""],[3,"nbSpinner",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["status","primary","nbInput","","type","text","formControlName","name",1,"editable-input",3,"id","value"],["class","text-danger",4,"ngIf"],["status","primary","nbInput","","type","text","formControlName","nameShort",1,"editable-input",3,"id","value"],["status","primary","nbInput","","type","number","formControlName","amountOfWorkstations",1,"editable-input",3,"id","value"],["fullWidth","","status","control","placeholder","Buffer type","formControlName","bufferType",1,"select","editable-input"],[3,"value",4,"ngFor","ngForOf"],["status","primary","nbInput","","type","number","formControlName","capacity",1,"editable-input",3,"value"],["fullWidth","","status","control","placeholder","Activity","formControlName","activity",1,"select","editable-input"],["fullWidth","","status","control","placeholder","Workcenter","formControlName","workcenter",1,"select","editable-input"],[1,"float-right","icons-wrapper"],["class","iconEcheclon icon-warning_red cursor-pointer mr-3",3,"nbTooltip",4,"ngIf"],["class","iconEcheclon icon-edit cursor-pointer mr-1",3,"click",4,"ngIf"],["class","iconEcheclon icon-confirm cursor-pointer mr-1",3,"ngClass","click",4,"ngIf"],["class","iconEcheclon icon-close cursor-pointer",3,"click",4,"ngIf"],["class","iconEcheclon icon-bin cursor-pointer",3,"click",4,"ngIf"],[1,"text-danger"],[3,"value"],[1,"iconEcheclon","icon-warning_red","cursor-pointer","mr-3",3,"nbTooltip"],[1,"iconEcheclon","icon-edit","cursor-pointer","mr-1",3,"click"],[1,"iconEcheclon","icon-confirm","cursor-pointer","mr-1",3,"ngClass","click"],[1,"iconEcheclon","icon-close","cursor-pointer",3,"click"],[1,"iconEcheclon","icon-bin","cursor-pointer",3,"click"],["colspan","8",1,"border-0","text-center"],[3,"nbSpinner"],["colspan","8",1,"spinner-cell"]],template:function(n,e){1&n&&(t.ynx(0),t.TgZ(1,"div",0),t.NdJ("scroll",function(){return e.checkIfScrolledToBottom()}),t.YNc(2,mt,27,5,"table",1),t.qZA(),t.BQk()),2&n&&(t.xp6(1),t.Q6J("nbSpinner",!e.dataAvailable),t.xp6(1),t.Q6J("ngIf",e.dataAvailable))},directives:[l.Q7R,h.O5,a.JL,a.sg,l.fMN,a.CE,h.sg,a.x0,l.h8i,a.Fj,a.JJ,a.u,a.wV,l.rs,l.q51,l.jNv,h.mk],styles:[".table-container[_ngcontent-%COMP%]{max-height:60vh;overflow:scroll}.spinner-cell[_ngcontent-%COMP%]{padding-top:50px}"],changeDetection:0}),k=(0,C.gn)([(0,p.c)()],k);let ft=(()=>{class i{constructor(e){this.elementRef=e}onInput(){this.resize()}ngOnInit(){this.elementRef.nativeElement.scrollHeight&&setTimeout(()=>this.resize())}resize(){this.elementRef.nativeElement.style.height="0",this.elementRef.nativeElement.style.height=`${this.elementRef.nativeElement.scrollHeight+5}px`}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.SBq))},i.\u0275dir=t.lG2({type:i,selectors:[["","appTextareaAutoresize",""]],hostBindings:function(e,o){1&e&&t.NdJ("input",function(){return o.onInput()})}}),i})(),ht=(()=>{class i{constructor(e){this.elementRef=e,this.isExpanded=!1,this.wrappers=[]}onClick(e){this.isExpanded=!this.isExpanded,this.resize()}ngAfterViewInit(){this.wrappers=this.elementRef.nativeElement.parentElement.parentElement.querySelectorAll(".toggle-height-wrapper"),this.wrappers.forEach(e=>{e.style.maxHeight="47px"})}resize(){this.wrappers.forEach(this.isExpanded?e=>e.style.maxHeight="none":e=>e.style.maxHeight="47px")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.SBq))},i.\u0275dir=t.lG2({type:i,selectors:[["","appToggleElementHeight",""]],hostBindings:function(e,o){1&e&&t.NdJ("click",function(s){return o.onClick(s)})}}),i})();function gt(i,n){1&i&&(t.TgZ(0,"span",24),t._uU(1," This field is required "),t.qZA())}function vt(i,n){1&i&&(t.TgZ(0,"span",24),t._uU(1," This field is required "),t.qZA())}function bt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",25),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).toggleEdit(r)}),t.qZA()}}const Tt=function(i){return{disabled:i}};function kt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",26),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).saveEdit(r)}),t.qZA()}if(2&i){const e=t.oxw().index,o=t.oxw(3);let r;t.Q6J("ngClass",t.VKq(1,Tt,null==(r=o.getControl(e).get("name"))?null:r.getError("required")))}}function wt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",27),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().index;return t.oxw(3).cancelEdit(r)}),t.qZA()}}function xt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",28),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(),s=r.$implicit,c=r.index;return t.oxw(3).onDelete(s.uuid,c)}),t.qZA()}}function yt(i,n){1&i&&t._UZ(0,"i",29)}function At(i,n){if(1&i&&(t.TgZ(0,"tr",11)(1,"td"),t._UZ(2,"input",12),t.YNc(3,gt,2,0,"span",13),t.qZA(),t.TgZ(4,"td"),t._UZ(5,"input",14),t.YNc(6,vt,2,0,"span",13),t.qZA(),t.TgZ(7,"td")(8,"div",15)(9,"textarea",16),t._uU(10,"              "),t.qZA()()(),t.TgZ(11,"td")(12,"div",17),t.YNc(13,bt,1,0,"i",18),t.YNc(14,kt,1,3,"i",19),t.YNc(15,wt,1,0,"i",20),t.YNc(16,xt,1,0,"i",21),t.qZA()(),t.TgZ(17,"td",22),t.YNc(18,yt,1,0,"i",23),t.qZA()()),2&i){const e=n.$implicit,o=n.index,r=t.oxw(3);let s,c;t.Q6J("formGroupName",o),t.xp6(2),t.s9C("id",e.name),t.s9C("value",e.name),t.xp6(1),t.Q6J("ngIf",(null==(s=r.getControl(o).get("name"))?null:s.touched)&&(null==(s=r.getControl(o).get("name"))?null:s.getError("required"))),t.xp6(2),t.s9C("id",e.nameShort),t.s9C("value",e.nameShort),t.xp6(1),t.Q6J("ngIf",(null==(c=r.getControl(o).get("nameShort"))?null:c.touched)&&(null==(c=r.getControl(o).get("nameShort"))?null:c.getError("required"))),t.xp6(3),t.s9C("id",e.description),t.s9C("value",e.description),t.xp6(4),t.Q6J("ngIf",r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",!r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",!r.formControlState(o)),t.xp6(1),t.Q6J("ngIf",r.formControlState(o)),t.xp6(2),t.Q6J("ngIf",e.description&&e.description.length&&e.description.length>20)}}function Ct(i,n){if(1&i&&(t.ynx(0),t.YNc(1,At,19,14,"tr",10),t.BQk()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.activities)}}function Zt(i,n){1&i&&(t.TgZ(0,"tr")(1,"td",30),t._uU(2,"There are no activites to display."),t.qZA()())}function It(i,n){if(1&i&&(t.TgZ(0,"tr",31),t._UZ(1,"td",32),t.qZA()),2&i){const e=t.oxw(2);t.Q6J("nbSpinner",e.isLoading)}}function Nt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"th",3),t._uU(6,"Name Short"),t.qZA(),t.TgZ(7,"th",3),t._uU(8,"Description"),t.qZA(),t.TgZ(9,"th",3),t._uU(10,"Actions"),t.qZA(),t.TgZ(11,"th",3)(12,"div",4)(13,"nb-icon",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAdd()}),t.qZA()()()()(),t.TgZ(14,"tbody",6),t.YNc(15,Ct,2,1,"ng-container",7),t.YNc(16,Zt,3,0,"ng-template",null,8,t.W1O),t.YNc(18,It,2,1,"tr",9),t.qZA()()}if(2&i){const e=t.MAs(17),o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(14),t.Q6J("formArrayName","formArrayName"),t.xp6(1),t.Q6J("ngIf",null==o.activities?null:o.activities.length)("ngIfElse",e),t.xp6(3),t.Q6J("ngIf",o.maxPages>=o.currentDataPage)}}let w=class{constructor(n,e,o,r,s,c){this.workstationApi=n,this.activityApi=e,this.cdr=o,this.formBuilder=r,this.dialog=s,this.toastrService=c,this.dataAvailable=!1,this.currentDataPage=1,this.maxPages=1,this.isLoading=!1,this.workstations=[],this.editable=!1,this.positions=l.fe3,this.reloadData="",this.editItem=new t.vpe,this.removeItem=new t.vpe,this.addNewItem=new t.vpe,this.form=new a.cw({formArrayName:this.formBuilder.array([])})}ngOnInit(){this.findData()}getBuffersType(){}buildForm(){this.form=this.formBuilder.group({formArrayName:this.formBuilder.array(this.activities.map(n=>{var e,o,r,s;return this.createActivityGroup(!!n.uuid,null!==(e=n.name)&&void 0!==e?e:"",null!==(o=n.nameShort)&&void 0!==o?o:"",null!==(r=n.description)&&void 0!==r?r:"",null!==(s=n.uuid)&&void 0!==s?s:"")}))})}createActivityGroup(n=!0,e="",o="",r="",s=""){return this.formBuilder.group({name:new a.NI({value:e,disabled:n},a.kI.required),nameShort:new a.NI({value:o,disabled:n},a.kI.required),description:new a.NI({value:r,disabled:n}),uuid:new a.NI({value:s,disabled:n})})}onAdd(){var n;null===(n=this.activities)||void 0===n||n.push({name:"",nameShort:"",description:""}),this.buildForm(),this.cdr.markForCheck()}onRemove(n){var e;null===(e=this.activities)||void 0===e||e.splice(n,1),this.form.get("formArrayName").removeAt(n),this.cdr.markForCheck()}onDelete(n,e){const o=this.dialog.open(I.D);o.componentRef.instance.title="Remove activity",o.componentRef.instance.text="Are you sure you want to remove this activity?",o.onBackdropClick.pipe((0,p.t)(this)).subscribe(()=>{o.close()}),o.componentRef.instance.completed.pipe((0,p.t)(this)).subscribe(r=>{n?this.activityApi.dataActivityDeleteUuidDelete(n).pipe((0,p.t)(this)).subscribe(()=>{this.onRemove(e),this.cdr.markForCheck(),o.close(),this.showToast(this.positions.TOP_RIGHT,"success","Activity succesfully removed.",3e3)},s=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)}):(this.onRemove(e),o.close())})}saveEdit(n){const o=this.form.get("formArrayName").controls[n],r={name:o.value.name,nameShort:o.value.nameShort,description:o.value.description},s=o.value.uuid;s?(r.uuid=s,this.activityApi.dataActivityUpdateUuidPut(s,r).pipe((0,p.t)(this)).subscribe(c=>{var u;let d=null===(u=this.activities)||void 0===u?void 0:u.findIndex(_=>_.uuid===s);this.activities[d].name=r.name,this.activities[d].nameShort=r.nameShort,this.activities[d].description=r.description,this.showToast(this.positions.TOP_RIGHT,"success","Activity succesfully updated.",3e3)},c=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)})):(r.uuid=(0,N.Z)(),this.activityApi.dataActivityCreatePost(r).pipe((0,p.t)(this)).subscribe(c=>{this.activities[this.activities.length-1]=r,this.showToast(this.positions.TOP_RIGHT,"success","Activity succesfully created.",3e3)},c=>{this.showToast(this.positions.TOP_RIGHT,"danger","Something went wrong, please try again later.",3e3)})),this.toggleEdit(n)}toggleEdit(n){const e=this.form.get("formArrayName");"DISABLED"===e.controls[n].status?e.controls[n].enable():e.controls[n].disable()}getControl(n){return this.form.get("formArrayName").controls[n]}cancelEdit(n){var e;this.toggleEdit(n);const o=this.form.get("formArrayName"),r=null===(e=this.activities)||void 0===e?void 0:e.find(s=>s.uuid===o.controls[n].value.uuid);o.controls[n].patchValue({name:null==r?void 0:r.name,nameShort:null==r?void 0:r.nameShort,description:null==r?void 0:r.description})}formControlState(n){return this.form.get("formArrayName").controls[n].disabled}getControlsArray(){return this.form.get("formArrayName")}findData(){(0,Z.D)([this.workstationApi.dataWorkstationAllWorkstationsGet(),this.activityApi.dataActivityListGet()]).pipe((0,p.t)(this)).subscribe({next:([n,e])=>{this.workstations=n.selectItems,this.activities=e.items,this.activitiesResponse=e,this.maxPages=e.totalPages,this.dataAvailable=!0,this.buildForm(),this.cdr.markForCheck(),this.showToast(this.positions.TOP_RIGHT,"danger",this.createToastMessage())}})}createToastMessage(){var n;const e=[];return null===(n=this.activities)||void 0===n||n.forEach(o=>{var r;(null===(r=null==o?void 0:o.missingLinks)||void 0===r?void 0:r.length)&&e.push(o.name)}),e.length?`${e.join(", ")} activities has no workstation connection.`:""}getWarningInfo(n){const e=null==n?void 0:n.map(o=>o.displayValue).join(". ");return null!=e?e:""}showToast(n,e,o,r=5e3,s=""){!o||this.toastrService.show(e||"Success",o,{icon:s,position:n,status:e,duration:r,destroyByClick:!0,limit:1})}checkIfScrolledToBottom(){const n=document.getElementById("activites-table-list");(null==n?void 0:n.scrollTop)-((null==n?void 0:n.scrollHeight)-(null==n?void 0:n.clientHeight))>-20&&(this.currentDataPage++,this.getNextPage())}getNextPage(){this.maxPages>=this.currentDataPage&&(this.isLoading=!0,this.workstationApi.dataWorkstationListGet(void 0,void 0,this.currentDataPage.toString(),void 0,"response").subscribe(n=>{this.activities=[...this.activities,...n.body.items],this.activities=this.activities.filter((e,o,r)=>o===r.findIndex(s=>s.uuid===e.uuid)),this.isLoading=!1,this.buildForm(),this.cdr.detectChanges()}))}};w.\u0275fac=function(n){return new(n||w)(t.Y36(b.F),t.Y36(b.B0),t.Y36(t.sBO),t.Y36(a.qu),t.Y36(l.Gln),t.Y36(l.quB))},w.\u0275cmp=t.Xpm({type:w,selectors:[["app-activity-table"]],inputs:{reloadData:"reloadData"},outputs:{editItem:"editItem",removeItem:"removeItem",addNewItem:"addNewItem"},decls:2,vars:2,consts:[["id","activites-table-list",1,"spinner-wrapper","table-container","table-fixed-header",3,"nbSpinner","scroll"],["class","table",3,"formGroup",4,"ngIf"],[1,"table",3,"formGroup"],["scope","col"],[1,"float-right"],["title","Create","icon","add_circle",3,"click"],[3,"formArrayName"],[4,"ngIf","ngIfElse"],["noData",""],[3,"nbSpinner",4,"ngIf"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["status","primary","nbInput","","type","text","formControlName","name",1,"editable-input",3,"id","value"],["class","text-danger",4,"ngIf"],["status","primary","nbInput","","type","text","formControlName","nameShort",1,"editable-input",3,"id","value"],[1,"overflow-hidden","toggle-height-wrapper"],["appTextareaAutoresize","","status","primary","nbInput","","type","text","formControlName","description",1,"editable-input",3,"id","value"],[1,"float-right","icons-wrapper"],["class","iconEcheclon icon-edit cursor-pointer mr-1",3,"click",4,"ngIf"],["class","iconEcheclon icon-confirm cursor-pointer mr-1",3,"ngClass","click",4,"ngIf"],["class","iconEcheclon icon-close cursor-pointer",3,"click",4,"ngIf"],["class","iconEcheclon icon-bin cursor-pointer",3,"click",4,"ngIf"],[1,"text-right"],["appToggleElementHeight","","class","iconEcheclon icon-arrow-down",4,"ngIf"],[1,"text-danger"],[1,"iconEcheclon","icon-edit","cursor-pointer","mr-1",3,"click"],[1,"iconEcheclon","icon-confirm","cursor-pointer","mr-1",3,"ngClass","click"],[1,"iconEcheclon","icon-close","cursor-pointer",3,"click"],[1,"iconEcheclon","icon-bin","cursor-pointer",3,"click"],["appToggleElementHeight","",1,"iconEcheclon","icon-arrow-down"],["colspan","5",1,"border-0","text-center"],[3,"nbSpinner"],["colspan","5",1,"spinner-cell"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0),t.NdJ("scroll",function(){return e.checkIfScrolledToBottom()}),t.YNc(1,Nt,19,5,"table",1),t.qZA()),2&n&&(t.Q6J("nbSpinner",!e.dataAvailable),t.xp6(1),t.Q6J("ngIf",e.dataAvailable))},directives:[l.Q7R,h.O5,a.JL,a.sg,l.fMN,a.CE,h.sg,a.x0,l.h8i,a.Fj,a.JJ,a.u,ft,h.mk,ht],styles:[".table-container[_ngcontent-%COMP%]{max-height:60vh;overflow:scroll}"],changeDetection:0}),w=(0,C.gn)([(0,p.c)()],w);let x=class{};x.\u0275fac=function(n){return new(n||x)},x.\u0275cmp=t.Xpm({type:x,selectors:[["app-flow-table"]],decls:2,vars:0,template:function(n,e){1&n&&(t.TgZ(0,"p"),t._uU(1,"Flow table is not implkemented"),t.qZA())},styles:[""]}),x=(0,C.gn)([(0,p.c)()],x);var q=f(6798),St=f(9004),Wt=f(4515);let Et=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-activities"]],decls:6,vars:0,template:function(e,o){1&e&&(t.TgZ(0,"h1"),t._uU(1,"Activities"),t.qZA(),t._UZ(2,"hr"),t.TgZ(3,"p"),t._uU(4," Define and describe activities. An activity can be linked to a workstation to help planning and have a better understanding of the work (the activity) that is execuited by the workforce on a specific workstation.\n"),t.qZA(),t._UZ(5,"app-activity-table"))},directives:[w],styles:[""],changeDetection:0}),i})(),qt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-flows"]],decls:3,vars:0,template:function(e,o){1&e&&(t.TgZ(0,"p"),t._uU(1,"flows"),t.qZA(),t._UZ(2,"app-flow-table"))},directives:[x],styles:[""]}),i})();function Bt(i,n){if(1&i&&t._UZ(0,"nb-icon",16),2&i){const e=t.oxw().$implicit,o=t.oxw(3);t.Q6J("nbTooltip",o.getWarningInfo(e.missingLinks))}}function Jt(i,n){if(1&i&&(t.TgZ(0,"div")(1,"div",8),t.YNc(2,Bt,1,1,"nb-icon",9),t.TgZ(3,"div",10),t._UZ(4,"img",11),t.qZA(),t.TgZ(5,"div",12)(6,"div",13)(7,"p",14),t._uU(8,"Workstation:"),t.qZA(),t.TgZ(9,"p",15),t._uU(10),t.qZA()(),t.TgZ(11,"div",13)(12,"p",14),t._uU(13,"Activity:"),t.qZA(),t.TgZ(14,"p",15),t._uU(15),t.qZA()(),t.TgZ(16,"div",13)(17,"p",14),t._uU(18,"Short:"),t.qZA(),t.TgZ(19,"p",15),t._uU(20),t.qZA()()()()()),2&i){const e=n.$implicit;t.xp6(2),t.Q6J("ngIf","Warning"===e.linkStatus||"Critical"===e.linkStatus),t.xp6(8),t.Oqu(e.displayValue),t.xp6(5),t.Oqu(null==e.activity?null:e.activity.displayValue),t.xp6(5),t.Oqu(e.code)}}function Ot(i,n){if(1&i&&(t.TgZ(0,"div",5)(1,"h2",5),t._uU(2),t.qZA(),t.TgZ(3,"div",6),t.YNc(4,Jt,21,4,"div",7),t.qZA()()),2&i){const e=n.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Q6J("ngForOf",e.workstations)}}function Ft(i,n){if(1&i&&t._UZ(0,"div",17),2&i){const e=t.oxw(2);t.Q6J("nbSpinner",e.isLoading)}}function Ut(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",2),t.NdJ("scroll",function(){return t.CHM(e),t.oxw().checkIfScrolledToBottom()}),t.YNc(1,Ot,5,2,"div",3),t.YNc(2,Ft,1,1,"div",4),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.dataTree),t.xp6(1),t.Q6J("ngIf",e.isLoading)}}let y=class{constructor(n,e,o){this.cdr=n,this.workcenterApi=e,this.workstationApi=o,this.dataAvalaible=!1,this.dataTree=[],this.currentDataPage=1,this.maxPages=1,this.isLoading=!1}ngOnInit(){this.getData()}getData(){(0,Z.D)([this.workcenterApi.dataWorkCenterListGet(),this.workstationApi.dataWorkstationListGet()]).pipe((0,p.t)(this)).subscribe({next:([n,e])=>{this.workcentersResponse=n,this.workcenters=n.items,this.dataAvalaible=!0,this.maxPages=n.totalPages,(null==e?void 0:e.totalItemCount)>(null==e?void 0:e.ipp)?this.fetchWorkstations(null==e?void 0:e.totalItemCount):(this.workstations=e,this.buildDataTree(),this.cdr.markForCheck())}})}fetchWorkstations(n){this.workstationApi.dataWorkstationListGet(void 0,void 0,void 0,n.toString()).pipe((0,p.t)(this)).subscribe(e=>{this.workstations=e,this.buildDataTree(),this.cdr.markForCheck()})}buildDataTree(){const n=this.workcenters.map(e=>{var o;return null===(o=e.workstations)||void 0===o||o.forEach((r,s)=>{const c=r.reference,u=this.workstations.items.find(d=>d.uuid===c);e.workstations[s]=Object.assign(Object.assign({},e.workstations[s]),u)}),e});this.dataTree=n,console.log(this.dataTree)}getWarningInfo(n){return n.map(o=>o.displayValue).join(". ")}checkIfScrolledToBottom(){const n=document.getElementById("site-overview-data-list");(null==n?void 0:n.scrollTop)-((null==n?void 0:n.scrollHeight)-(null==n?void 0:n.clientHeight))>-20&&(this.currentDataPage++,this.getNextPage())}getNextPage(){this.maxPages>=this.currentDataPage&&(this.isLoading=!0,this.workcenterApi.dataWorkCenterListGet(void 0,void 0,this.currentDataPage.toString()).subscribe(n=>{this.workcenters=[...this.workcenters,...n.items],this.workcenters=this.workcenters.filter((e,o,r)=>o===r.findIndex(s=>s.uuid===e.uuid)),this.isLoading=!1,this.buildDataTree(),this.cdr.detectChanges()}))}};y.\u0275fac=function(n){return new(n||y)(t.Y36(t.sBO),t.Y36(b.Uv),t.Y36(b.F))},y.\u0275cmp=t.Xpm({type:y,selectors:[["app-overview"]],decls:3,vars:2,consts:[[3,"nbSpinner"],["class","data-container","id","site-overview-data-list",3,"scroll",4,"ngIf"],["id","site-overview-data-list",1,"data-container",3,"scroll"],["class","mb-3",4,"ngFor","ngForOf"],["class","spinner-container",3,"nbSpinner",4,"ngIf"],[1,"mb-3"],[1,"row"],[4,"ngFor","ngForOf"],[1,"item-card"],["nbTooltipStatus","primary","class","item-card__warning warning-icon","icon","warning",3,"nbTooltip",4,"ngIf"],[1,"item-card__image-wrapper"],["src","assets/images/packing.jpg","alt",""],[1,"item-card__content"],[1,"item-card__text"],[1,"item-card__label"],[1,"item-card__value"],["nbTooltipStatus","primary","icon","warning",1,"item-card__warning","warning-icon",3,"nbTooltip"],[1,"spinner-container",3,"nbSpinner"]],template:function(n,e){1&n&&(t.ynx(0),t.TgZ(1,"div",0),t.YNc(2,Ut,3,2,"div",1),t.qZA(),t.BQk()),2&n&&(t.xp6(1),t.Q6J("nbSpinner",!e.dataAvalaible),t.xp6(1),t.Q6J("ngIf",e.dataAvalaible))},directives:[l.Q7R,h.O5,h.sg,l.fMN,l.jNv],styles:[".data-container[_ngcontent-%COMP%]{max-height:71vh;overflow-y:scroll;padding-left:15px;overflow-x:hidden}.spinner-container[_ngcontent-%COMP%]{height:100px}"]}),y=(0,C.gn)([(0,p.c)()],y);const Dt=[{path:"overview",component:y},{path:"activity",component:Et},{path:"workcenter",component:(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-workcenters"]],decls:6,vars:0,template:function(e,o){1&e&&(t.TgZ(0,"h1"),t._uU(1,"Workcenters"),t.qZA(),t._UZ(2,"hr"),t.TgZ(3,"p"),t._uU(4," View and define your work centers here. A work center can contain zero or more workstations. These workstations can be linked to the work center in the details view.\n"),t.qZA(),t._UZ(5,"app-workcenter-table"))},directives:[T],styles:[""],changeDetection:0}),i})()},{path:"workstation",component:(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-workstations"]],decls:6,vars:0,template:function(e,o){1&e&&(t.TgZ(0,"h1"),t._uU(1,"Workstations"),t.qZA(),t._UZ(2,"hr"),t.TgZ(3,"p"),t._uU(4,"View and define your work stations here."),t.qZA(),t._UZ(5,"app-workstation-table"))},directives:[k],styles:[""],changeDetection:0}),i})()},{path:"flow",component:qt},{path:"",pathMatch:"full",redirectTo:"overview"},{path:"**",component:St.r}];let Pt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[q.Bz.forChild(Dt),Wt.n],q.Bz]}),i})(),Qt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[h.ez,a.u5,a.UX,Pt,l.T2N,l.zyh,l.KdK,l._WB,l.IIj,l.EoG,J,l.uuI,l.rgH,W.r,l.nKr,l.COg,E]]}),i})()}}]);