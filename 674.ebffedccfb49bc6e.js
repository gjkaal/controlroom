"use strict";(self.webpackChunkechelon=self.webpackChunkechelon||[]).push([[674],{8674:(He,M,m)=>{m.r(M),m.d(M,{OccupationPlanModule:()=>Ye});var h=m(9808),l=m(6781),e=m(5e3);let Y=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.ez,l.nKr,l.KdK]]}),o})();m(5538);var H=m(8929),S=m(2916),V=m(1709),B=m(537),T=(()=>{return(o=T||(T={}))[o.Queue=0]="Queue",o[o.Uploading=1]="Uploading",o[o.Done=2]="Done",o[o.Cancelled=3]="Cancelled",T;var o})();function w(o){if(0===o)return"0 Byte";const i=Math.floor(Math.log(o)/Math.log(1024));return parseFloat((o/Math.pow(1024,i)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][i]}class q{constructor(n=Number.POSITIVE_INFINITY,t=["*"],i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY){this.queue=[],this.serviceEvents=new e.vpe,this.uploadScheduler=new H.xQ,this.subs=[],this.contentTypes=t,this.maxUploads=i,this.maxFileSize=r,this.uploadScheduler.pipe((0,V.zg)(a=>this.startUpload(a),n)).subscribe(a=>this.serviceEvents.emit(a))}handleFiles(n){const t=[].reduce.call(n,(i,r,a)=>{const c=i.length+this.queue.length+1;if(this.isContentTypeAllowed(r.type)&&c<=this.maxUploads&&this.isFileSizeAllowed(r.size))i=i.concat(r);else{const u=this.makeUploadFile(r,a);this.serviceEvents.emit({type:"rejected",file:u})}return i},[]);this.queue.push(...[].map.call(t,(i,r)=>{const a=this.makeUploadFile(i,r);return this.serviceEvents.emit({type:"addedToQueue",file:a}),a})),this.serviceEvents.emit({type:"allAddedToQueue"})}initInputEvents(n){return n.subscribe(t=>{switch(t.type){case"uploadFile":const i=this.queue.findIndex(s=>s===t.file);-1!==i&&t.file&&this.uploadScheduler.next({file:this.queue[i],event:t});break;case"uploadAll":this.queue.filter(s=>s.progress.status===T.Queue).forEach(s=>this.uploadScheduler.next({file:s,event:t}));break;case"cancel":const a=t.id||null;if(!a)return;this.subs.filter(s=>s.id===a).forEach(s=>{if(s.sub){s.sub.unsubscribe();const p=this.queue.findIndex(d=>d.id===a);-1!==p&&(this.queue[p].progress.status=T.Cancelled,this.serviceEvents.emit({type:"cancelled",file:this.queue[p]}))}});break;case"cancelAll":this.subs.forEach(s=>{s.sub&&s.sub.unsubscribe();const p=this.queue.find(d=>d.id===s.id);p&&(p.progress.status=T.Cancelled,this.serviceEvents.emit({type:"cancelled",file:p}))});break;case"remove":if(!t.id)return;const u=this.queue.findIndex(s=>s.id===t.id);if(-1!==u){const s=this.queue[u];this.queue.splice(u,1),this.serviceEvents.emit({type:"removed",file:s})}break;case"removeAll":this.queue.length&&(this.queue=[],this.serviceEvents.emit({type:"removedAll"}))}})}startUpload(n){return new S.y(t=>{const i=this.uploadFile(n.file,n.event).pipe((0,B.x)(()=>{t.closed||t.complete()})).subscribe(r=>{t.next(r)},r=>{t.error(r),t.complete()},()=>{t.complete()});this.subs.push({id:n.file.id,sub:i})})}uploadFile(n,t){return new S.y(i=>{const r=t.url||"",a=t.method||"POST",c=t.data||{},u=t.headers||{},s=new XMLHttpRequest,p=(new Date).getTime();let d=n.progress.data&&n.progress.data.startTime||p,g=0,v=null;s.upload.addEventListener("progress",f=>{if(f.lengthComputable){const I=Math.round(100*f.loaded/f.total),F=(new Date).getTime()-p;g=Math.round(f.loaded/F*1e3),d=n.progress.data&&n.progress.data.startTime||(new Date).getTime(),v=Math.ceil((f.total-f.loaded)/g),n.progress={status:T.Uploading,data:{percentage:I,speed:g,speedHuman:`${w(g)}/s`,startTime:d,endTime:null,eta:v,etaHuman:this.secondsToHuman(v)}},i.next({type:"uploading",file:n})}},!1),s.upload.addEventListener("error",f=>{i.error(f),i.complete()}),s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){const f=Math.round(n.size/((new Date).getTime()-d)*1e3);n.progress={status:T.Done,data:{percentage:100,speed:f,speedHuman:`${w(f)}/s`,startTime:d,endTime:(new Date).getTime(),eta:v,etaHuman:this.secondsToHuman(v||0)}},n.responseStatus=s.status;try{n.response=JSON.parse(s.response)}catch(I){n.response=s.response}n.responseHeaders=this.parseResponseHeaders(s.getAllResponseHeaders()),i.next({type:"done",file:n}),i.complete()}},s.open(a,r,!0),s.withCredentials=!!t.withCredentials;try{const f=n.nativeFile,I=this.queue.findIndex(Z=>Z.nativeFile===f);let F;this.queue[I].progress.status===T.Cancelled&&i.complete(),Object.keys(u).forEach(Z=>s.setRequestHeader(Z,u[Z])),!1!==t.includeWebKitFormBoundary?(Object.keys(c).forEach(Z=>n.form.append(Z,c[Z])),n.form.append(t.fieldName||"file",f,f.name),F=n.form):F=f,this.serviceEvents.emit({type:"start",file:n}),s.send(F)}catch(f){i.complete()}return()=>{s.abort()}})}secondsToHuman(n){return new Date(1e3*n).toISOString().substr(11,8)}generateId(){return Math.random().toString(36).substring(7)}setContentTypes(n){this.contentTypes=void 0!==n&&n instanceof Array?void 0!==n.find(t=>"*"===t)?["*"]:n:["*"]}allContentTypesAllowed(){return void 0!==this.contentTypes.find(n=>"*"===n)}isContentTypeAllowed(n){return!!this.allContentTypesAllowed()||void 0!==this.contentTypes.find(t=>t===n)}isFileSizeAllowed(n){return!this.maxFileSize||n<=this.maxFileSize}makeUploadFile(n,t){return{fileIndex:t,id:this.generateId(),name:n.name,size:n.size,type:n.type,form:new FormData,progress:{status:T.Queue,data:{percentage:0,speed:0,speedHuman:`${w(0)}/s`,startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:new Date(n.lastModified),sub:void 0,nativeFile:n}}parseResponseHeaders(n){if(n)return n.split("\n").map(t=>t.split(/: */,2)).filter(t=>t[0]).reduce((t,i)=>(t[i[0]]=i[1],t),{})}}let G=(()=>{class o{constructor(t){this.elementRef=t,this.stopEvent=i=>{i.stopPropagation(),i.preventDefault()},this.uploadOutput=new e.vpe}ngOnInit(){this._sub=[],this.upload=new q(this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,this.options&&this.options.allowedContentTypes||["*"],this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY),this.el=this.elementRef.nativeElement,this._sub.push(this.upload.serviceEvents.subscribe(c=>{this.uploadOutput.emit(c)})),this.uploadInput instanceof e.vpe&&this._sub.push(this.upload.initInputEvents(this.uploadInput)),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)}ngOnDestroy(){this._sub.forEach(t=>t.unsubscribe())}onDrop(t){t.stopPropagation(),t.preventDefault(),this.uploadOutput.emit({type:"drop"}),this.upload.handleFiles(t.dataTransfer.files)}onDragOver(t){t&&this.uploadOutput.emit({type:"dragOver"})}onDragLeave(t){t&&this.uploadOutput.emit({type:"dragOut"})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","ngFileDrop",""]],hostBindings:function(t,i){1&t&&e.NdJ("drop",function(a){return i.onDrop(a)})("dragover",function(a){return i.onDragOver(a)})("dragleave",function(a){return i.onDragLeave(a)})},inputs:{options:"options",uploadInput:"uploadInput"},outputs:{uploadOutput:"uploadOutput"}}),o})(),z=(()=>{class o{constructor(t){this.elementRef=t,this.fileListener=()=>{this.el.files&&this.upload.handleFiles(this.el.files)},this.uploadOutput=new e.vpe}ngOnInit(){this._sub=[],this.upload=new q(this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,this.options&&this.options.allowedContentTypes||["*"],this.options&&this.options.maxUploads||Number.POSITIVE_INFINITY,this.options&&this.options.maxFileSize||Number.POSITIVE_INFINITY),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this._sub.push(this.upload.serviceEvents.subscribe(c=>{this.uploadOutput.emit(c)})),this.uploadInput instanceof e.vpe&&this._sub.push(this.upload.initInputEvents(this.uploadInput))}ngOnDestroy(){this.el&&(this.el.removeEventListener("change",this.fileListener,!1),this._sub.forEach(t=>t.unsubscribe()))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","ngFileSelect",""]],inputs:{options:"options",uploadInput:"uploadInput"},outputs:{uploadOutput:"uploadOutput"}}),o})(),R=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({}),o})(),j=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.ez,R,l.T2N,l.zyh,l.KdK,l.uuI]]}),o})();var O=m(655),b=m(4987),N=m(9295);function L(o,n){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.files[0].name)}}const $=function(o){return{"is-drop-over":o}};function K(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",6)(1,"div",7),e.NdJ("uploadOutput",function(r){return e.CHM(t),e.oxw().onUploadOutput(r)}),e.TgZ(2,"label",8)(3,"input",9),e.NdJ("uploadOutput",function(r){return e.CHM(t),e.oxw().onUploadOutput(r)}),e.qZA(),e._UZ(4,"nb-icon",10),e._uU(5," Drag and drop file "),e.qZA(),e.YNc(6,L,2,1,"p",11),e.qZA(),e.TgZ(7,"button",12),e.NdJ("click",function(){return e.CHM(t),e.oxw().startUpload()}),e._uU(8,"Import"),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("options",t.options)("uploadInput",t.uploadInput)("ngClass",e.VKq(6,$,t.dragOver)),e.xp6(2),e.Q6J("options",t.options)("uploadInput",t.uploadInput),e.xp6(3),e.Q6J("ngIf",t.files[0])}}function X(o,n){if(1&o&&(e.TgZ(0,"div",2)(1,"div",13)(2,"p"),e._uU(3),e.qZA()()()),2&o){const t=e.oxw();e.xp6(3),e.hij("Please wait while the ",t.files[0].name," is being imported.")}}function ee(o,n){if(1&o&&(e.TgZ(0,"div")(1,"p",18),e._UZ(2,"nb-icon",19),e.TgZ(3,"span"),e._uU(4),e.qZA()()()),2&o){const t=n.$implicit;e.xp6(4),e.Oqu(t)}}function te(o,n){1&o&&(e.TgZ(0,"button",20),e._uU(1,"Confirm"),e.qZA())}function ne(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",13),e.YNc(2,ee,5,1,"div",15),e.TgZ(3,"div",16)(4,"button",12),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCloseDialog()}),e._uU(5,"Cancel"),e.qZA(),e.YNc(6,te,2,0,"button",17),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.messages),e.xp6(4),e.Q6J("ngIf",!t.serverError)}}let C=class{constructor(n,t){this.dialog=n,this.api=t,this.uploadStarted=!1,this.importStarted=!1,this.noUpload=!0,this.uploadResult={},this.importResult={},this.messages=[],this.serverError=!1,this.options={concurrency:1,maxUploads:3,maxFileSize:1e9},this.files=[],this.uploadInput=new e.vpe,this.humanizeBytes=w}onUploadOutput(n){switch(n.type){case"allAddedToQueue":case"addedToQueue":case"uploading":void 0!==n.file&&(this.files[0]=n.file);break;case"removed":this.files=[];break;case"dragOver":this.dragOver=!0;break;case"dragOut":case"drop":this.dragOver=!1}}startUpload(){this.uploadStarted=!0,this.noUpload=!1,this.file=this.files[0].nativeFile,this.file&&this.api.dataImportUploadFilePost([this.file]).pipe((0,b.t)(this)).subscribe({next:n=>{this.uploadStarted=!1,this.uploadResult=n},error:n=>{console.log(n),this.uploadStarted=!1,500===n.status?(this.serverError=!0,this.messages.push("Someting went wrong")):this.messages.push(n.message)}})}onCloseDialog(){this.dialog.close()}};C.\u0275fac=function(n){return new(n||C)(e.Y36(l.X4l),e.Y36(N.kt))},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-import-csv-dialog"]],decls:10,vars:4,consts:[["nbSpinnerStatus","basic",3,"nbSpinner"],["icon","close",1,"import-dialog-close",3,"click"],[1,"upload-box"],["class","upload-box-content",4,"ngIf"],["class","upload-box",4,"ngIf"],["class","upload-box upload-errors",4,"ngIf"],[1,"upload-box-content"],["ngFileDrop","",1,"drop-container",3,"options","uploadInput","ngClass","uploadOutput"],[1,"upload-button"],["type","file","ngFileSelect","",3,"options","uploadInput","uploadOutput"],["icon","add_circle",1,"import-csv-icon"],[4,"ngIf"],["nbButton","","status","primary","size","medium",3,"click"],[1,"upload-box-inner"],[1,"upload-box","upload-errors"],[4,"ngFor","ngForOf"],[1,"buttons"],["nbButton","","status","primary","size","medium",4,"ngIf"],[1,"upload-error"],["icon","warning"],["nbButton","","status","primary","size","medium"]],template:function(n,t){1&n&&(e.TgZ(0,"nb-card",0)(1,"nb-card-header")(2,"h2"),e._uU(3,"Import CSV"),e.qZA(),e.TgZ(4,"nb-icon",1),e.NdJ("click",function(){return t.onCloseDialog()}),e.qZA()(),e.TgZ(5,"nb-card-body")(6,"div",2),e.YNc(7,K,9,8,"div",3),e.YNc(8,X,4,1,"div",4),e.YNc(9,ne,7,2,"div",5),e.qZA()()()),2&n&&(e.Q6J("nbSpinner",t.uploadStarted),e.xp6(7),e.Q6J("ngIf",t.noUpload),e.xp6(1),e.Q6J("ngIf",t.uploadStarted),e.xp6(1),e.Q6J("ngIf",t.messages.length>0))},directives:[l.Asz,l.Q7R,l.ndF,l.fMN,l.yKW,h.O5,G,h.mk,z,l.DPz,h.sg],styles:["nb-card-header[_ngcontent-%COMP%]{position:relative}.import-dialog-close[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;cursor:pointer}.upload-box[_ngcontent-%COMP%]{width:100%;height:auto;display:inline-block;border-radius:10px;min-height:100px}.upload-box-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.drop-container[_ngcontent-%COMP%], .upload-item[_ngcontent-%COMP%]{width:100%;width:527px;height:127px;background-image:url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' stroke='white' stroke-width='2' stroke-dasharray='5' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e\");padding:20px;display:inline-block}.drop-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;margin-bottom:15px}.upload-button[_ngcontent-%COMP%]{display:flex;align-items:center;border:none;outline:0;cursor:pointer;font-size:20px;padding:0 2px}.import-csv-icon[_ngcontent-%COMP%]{margin-right:15px}.upload-button[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.upload-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 30px}.upload-item-content[_ngcontent-%COMP%]{width:100%}.upload-error[_ngcontent-%COMP%]{display:flex}.upload-error[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:15px}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:48px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 17px}"]}),C=(0,O.gn)([(0,b.c)()],C);var _=m(3075);let E=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.ez]]}),o})(),J=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.ez]]}),o})(),oe=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.ez,l.T2N,l.zyh,l.KdK,j,_.u5,_.UX,l.OA,l.kmq,l.nKr,l.IIj,l.oGl,E,J,l.COg]]}),o})();var P=m(2268),U=m(890);const W=function(o){return{active:o}};function ie(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nb-list-item",4),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw().onChoosePlan(a.reference)}),e._uU(1),e.qZA()}if(2&o){const t=n.$implicit,i=e.oxw();e.Q6J("ngClass",e.VKq(2,W,i.choosenPlan===t.reference)),e.xp6(1),e.hij(" ",t.displayValue," ")}}let x=class{constructor(n,t,i){this.dialog=n,this.router=t,this.siteOccupationApi=i,this.plans=[],this.choosenPlan=""}ngOnInit(){this.setSavedPlans(),this.plans=[{reference:"3fa85f64-5717-4562-b3fc-2c963f66afa6",code:"Test",displayValue:"Test plan"},{reference:"3fa85f64-5717-4562-b3fc-2c963f66afa7",code:"Test 2",displayValue:"Test plan 2"},{reference:"3fa85f64-5717-4562-b3fc-2c963f66afa8",code:"Test 3",displayValue:"Test plan 3"}]}onChoosePlan(n){this.choosenPlan=n}setSavedPlans(){this.siteOccupationApi.dataSiteOccupationPlanTemplatesGet().pipe((0,b.t)(this)).subscribe({next:n=>{console.log(n)}})}onCloseDialog(){this.dialog.close()}navigateToManualCreate(){this.dialog.close(),this.router.navigate(["occupation/plan/manual"],{state:{planOption:this.choosenPlan}})}};x.\u0275fac=function(n){return new(n||x)(e.Y36(l.X4l),e.Y36(P.F0),e.Y36(U.j))},x.\u0275cmp=e.Xpm({type:x,selectors:[["app-plan-manual-import-dialog"]],decls:18,vars:4,consts:[["icon","close",1,"import-dialog-close",3,"click"],[1,"manual-options-wrapper"],[1,"row","mb-1"],[1,"col-sm-12"],[3,"ngClass","click"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"buttons"],["nbButton","","status","primary","size","medium",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"nb-card")(1,"nb-card-header")(2,"h2"),e._uU(3,"Select manual option"),e.qZA(),e.TgZ(4,"nb-icon",0),e.NdJ("click",function(){return t.onCloseDialog()}),e.qZA()(),e.TgZ(5,"nb-card-body")(6,"div",1)(7,"div",2)(8,"div",3)(9,"nb-list")(10,"nb-list-item",4),e.NdJ("click",function(){return t.onChoosePlan("manual")}),e._uU(11," Manual "),e.qZA(),e.YNc(12,ie,2,4,"nb-list-item",5),e.qZA()()()(),e.TgZ(13,"div",6)(14,"button",7),e.NdJ("click",function(){return t.onCloseDialog()}),e._uU(15,"Cancel"),e.qZA(),e.TgZ(16,"button",7),e.NdJ("click",function(){return t.navigateToManualCreate()}),e._uU(17,"Select"),e.qZA()()()()),2&n&&(e.xp6(10),e.Q6J("ngClass",e.VKq(2,W,"manual"===t.choosenPlan)),e.xp6(2),e.Q6J("ngForOf",t.plans))},directives:[l.Asz,l.ndF,l.fMN,l.yKW,l.zP_,l.qBV,h.mk,h.sg,l.DPz],styles:["nb-card-header[_ngcontent-%COMP%]{position:relative}.import-dialog-close[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;cursor:pointer}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:48px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 17px}.manual-options-wrapper[_ngcontent-%COMP%]{min-width:532px;padding:0 50px}nb-list-item[_ngcontent-%COMP%]{cursor:pointer}nb-list-item[_ngcontent-%COMP%]{background-color:var(--color-primary-500);margin-bottom:.5rem}nb-list-item.active[_ngcontent-%COMP%]{background-color:var(--color-primary-800)}"]}),x=(0,O.gn)([(0,b.c)()],x);let re=(()=>{class o{constructor(t){this.dialogService=t}onOpenImportModal(){this.dialogService.open(C)}onOpenManualImportModal(){this.dialogService.open(x)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.Gln))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-start-setting-up-plans"]],viewQuery:function(t,i){if(1&t&&e.Gf(C,5),2&t){let r;e.iGM(r=e.CRH())&&(i.importCsvDialogComponent=r.first)}},decls:8,vars:0,consts:[[1,"d-flex","justify-content-center","align-items-center"],[1,"fw-bold"],[1,"buttons"],["nbButton","","status","primary","size","medium",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Start setting up the plan"),e.qZA(),e.TgZ(3,"div",2)(4,"button",3),e.NdJ("click",function(){return i.onOpenImportModal()}),e._uU(5,"Import CSV"),e.qZA(),e.TgZ(6,"button",3),e.NdJ("click",function(){return i.onOpenManualImportModal()}),e._uU(7,"Manual"),e.qZA()()())},directives:[l.DPz],styles:[".d-flex[_ngcontent-%COMP%]{flex-direction:column;min-height:50vh}.buttons[_ngcontent-%COMP%]{display:flex;margin-top:48px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 17px}"]}),o})(),ae=(()=>{class o{constructor(t){this.element=t,this.editableClass=!0,this._appEditable=!1,this.appEditableManual=!1}get editableActiveClass(){return this.appEditable}get readonly(){return!this.appEditable}set appEditable(t){void 0===t||"string"==typeof t||this._appEditable===t||(this._appEditable=t)}get appEditable(){return this._appEditable}onClick(t){this._appEditable||t.stopPropagation()}onDoubleClick(){this.appEditableManual||(this.appEditable=!0)}onBlur(){this.element.nativeElement.classList.contains("open")||this.appEditableManual||!this._appEditable||(this.appEditable=!1)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","appEditable",""]],hostVars:5,hostBindings:function(t,i){1&t&&e.NdJ("click",function(a){return i.onClick(a)})("dblclick",function(){return i.onDoubleClick()})("focusout",function(){return i.onBlur()}),2&t&&(e.Ikx("readonly",i.readonly),e.ekj("editable",i.editableClass)("editable-active",i.editableActiveClass))},inputs:{appEditable:"appEditable",appEditableManual:"appEditableManual"}}),o})();function le(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nb-option",32),e.NdJ("selectionChange",function(r){e.CHM(t);const a=e.oxw().index,c=e.oxw(2).$implicit;return e.oxw(2).onSelectedWorkstationChange(r,a,c,"occupation")}),e._uU(1),e.qZA()}if(2&o){const t=n.$implicit;e.Q6J("id",null==t||null==t.value?null:t.value.reference)("value",""===(null==t?null:t.reference)||null==t?null:t.reference),e.xp6(1),e.hij("",null==t?null:t.name," ")}}function se(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function ce(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function ue(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function pe(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function de(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"tr",1)(1,"td")(2,"nb-select",19),e.YNc(3,le,2,3,"nb-option",20),e.qZA(),e.YNc(4,se,2,0,"span",21),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"input",22),e.YNc(9,ce,2,0,"span",21),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",23)(12,"nb-timepicker",24,25),e.YNc(14,ue,2,0,"span",21),e.qZA(),e.TgZ(15,"td"),e._UZ(16,"input",26)(17,"nb-timepicker",24,27),e.YNc(19,pe,2,0,"span",21),e.qZA(),e.TgZ(20,"td")(21,"nb-select",28)(22,"nb-option",29),e._uU(23,"Morning"),e.qZA(),e.TgZ(24,"nb-option",30),e._uU(25,"Evening"),e.qZA()()(),e.TgZ(26,"td")(27,"div",31)(28,"nb-icon",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).$implicit;return e.oxw(2).onAddOccupation(r)}),e.qZA(),e.TgZ(29,"nb-icon",11),e.NdJ("click",function(){const a=e.CHM(t).index,c=e.oxw(2).$implicit;return e.oxw(2).onRemoveOccupation(c,a)}),e.qZA()()()()}if(2&o){const t=n.$implicit,i=e.MAs(13),r=e.MAs(18),a=e.oxw(2).$implicit,c=e.oxw(2);let u,s,p,d;e.Q6J("formGroup",c.castToFormGroup(t)),e.xp6(2),e.Q6J("appEditable",!(null!=t&&null!=t.value&&t.value.name)),e.xp6(1),e.Q6J("ngForOf",c.getWorkstationsList(a)),e.xp6(1),e.Q6J("ngIf",(null==(u=t.get("reference"))?null:u.touched)&&(null==(u=t.get("reference"))?null:u.getError("required"))),e.xp6(2),e.Oqu(t.value.activity.displayValue),e.xp6(3),e.Q6J("ngIf",(null==(s=t.get("occupation"))?null:s.touched)&&(null==(s=t.get("occupation"))?null:s.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",i),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(p=t.get("startTime"))?null:p.touched)&&(null==(p=t.get("startTime"))?null:p.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",r),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(d=t.get("endTime"))?null:d.touched)&&(null==(d=t.get("endTime"))?null:d.getError("required")))}}function _e(o,n){if(1&o&&(e.ynx(0),e.YNc(1,de,30,12,"tr",18),e.BQk()),2&o){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.getArrayFromGroup(t,"occupation").controls)}}function me(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"div",31)(3,"nb-icon",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit;return e.oxw(2).onAddOccupation(r)}),e.qZA()()()()}}function ge(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nb-option",32),e.NdJ("selectionChange",function(r){e.CHM(t);const a=e.oxw().index,c=e.oxw(2).$implicit;return e.oxw(2).onSelectedWorkstationChange(r,a,c,"ratio")}),e._uU(1),e.qZA()}if(2&o){const t=n.$implicit;e.Q6J("id",null==t||null==t.value?null:t.value.reference)("value",""===(null==t?null:t.reference)||null==t?null:t.reference),e.xp6(1),e.hij("",null==t?null:t.name," ")}}function he(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function fe(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function ve(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function be(o,n){1&o&&(e.TgZ(0,"span",33),e._uU(1," This field is required "),e.qZA())}function Te(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"tr",1)(1,"td")(2,"nb-select",19),e.YNc(3,ge,2,3,"nb-option",20),e.qZA(),e.YNc(4,he,2,0,"span",21),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"input",34),e.YNc(9,fe,2,0,"span",21),e.qZA(),e.TgZ(10,"td"),e._UZ(11,"input",23)(12,"nb-timepicker",24,25),e.YNc(14,ve,2,0,"span",21),e.qZA(),e.TgZ(15,"td"),e._UZ(16,"input",26)(17,"nb-timepicker",24,27),e.YNc(19,be,2,0,"span",21),e.qZA(),e.TgZ(20,"td")(21,"div",31)(22,"nb-icon",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2).$implicit;return e.oxw(2).onAddRatio(r)}),e.qZA(),e.TgZ(23,"nb-icon",11),e.NdJ("click",function(){const a=e.CHM(t).index,c=e.oxw(2).$implicit;return e.oxw(2).onRemoveRatio(c,a)}),e.qZA()()()()}if(2&o){const t=n.$implicit,i=e.MAs(13),r=e.MAs(18),a=e.oxw(2).$implicit,c=e.oxw(2);let u,s,p,d;e.Q6J("formGroup",c.castToFormGroup(t)),e.xp6(2),e.Q6J("appEditable",!(null!=t&&null!=t.value&&t.value.name)),e.xp6(1),e.Q6J("ngForOf",c.getWorkstationsList(a)),e.xp6(1),e.Q6J("ngIf",(null==(u=t.get("reference"))?null:u.touched)&&(null==(u=t.get("reference"))?null:u.getError("required"))),e.xp6(2),e.Oqu(t.value.activity.displayValue),e.xp6(3),e.Q6J("ngIf",(null==(s=t.get("ratio"))?null:s.touched)&&(null==(s=t.get("ratio"))?null:s.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",i),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(p=t.get("startTime"))?null:p.touched)&&(null==(p=t.get("startTime"))?null:p.getError("required"))),e.xp6(2),e.Q6J("nbTimepicker",r),e.xp6(1),e.Q6J("step",15),e.xp6(2),e.Q6J("ngIf",(null==(d=t.get("endTime"))?null:d.touched)&&(null==(d=t.get("endTime"))?null:d.getError("required")))}}function Ce(o,n){if(1&o&&(e.ynx(0),e.YNc(1,Te,24,12,"tr",18),e.BQk()),2&o){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.getArrayFromGroup(t,"ratio").controls)}}function xe(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"div",31)(3,"nb-icon",10),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit;return e.oxw(2).onAddOccupation(r)}),e.qZA()()()()}}function ke(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"nb-accordion-item",4)(1,"nb-accordion-item-header")(2,"div",5)(3,"div",6)(4,"div")(5,"span",7),e._uU(6,"Workcenter"),e.qZA(),e.TgZ(7,"span",8),e._uU(8),e.qZA()()()()(),e.TgZ(9,"nb-accordion-item-body")(10,"div",9)(11,"nb-icon",10),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onOpenWorkcenterAddDialog("add","")}),e.qZA(),e.TgZ(12,"nb-icon",11),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(2).onOpenWorkcenterAddDialog("remove",a.value.uuid)}),e.qZA()(),e.TgZ(13,"div",12)(14,"table",13)(15,"thead")(16,"tr")(17,"th"),e._uU(18,"Workstation"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Activity"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Occupation"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Start"),e.qZA(),e.TgZ(25,"th"),e._uU(26,"End"),e.qZA(),e.TgZ(27,"th"),e._uU(28,"Shift"),e.qZA(),e.TgZ(29,"th"),e._UZ(30,"br"),e.qZA()()(),e.TgZ(31,"tbody"),e.YNc(32,_e,2,1,"ng-container",14),e.YNc(33,me,4,0,"ng-template",null,15,e.W1O),e.qZA()(),e.TgZ(35,"table",16)(36,"thead")(37,"tr")(38,"th"),e._uU(39,"Workstation"),e.qZA(),e.TgZ(40,"th"),e._uU(41,"Activity"),e.qZA(),e.TgZ(42,"th"),e._uU(43,"Ratio"),e.qZA(),e.TgZ(44,"th"),e._uU(45,"Start"),e.qZA(),e.TgZ(46,"th"),e._uU(47,"End"),e.qZA(),e.TgZ(48,"th"),e._UZ(49,"br"),e.qZA()()(),e.TgZ(50,"tbody"),e.YNc(51,Ce,2,1,"ng-container",14),e.YNc(52,xe,4,0,"ng-template",null,17,e.W1O),e.qZA()()()()()}if(2&o){const t=n.$implicit,i=e.MAs(34),r=e.MAs(53),a=e.oxw(2);e.Q6J("formGroup",a.castToFormGroup(t)),e.xp6(8),e.Oqu(t.value.name),e.xp6(24),e.Q6J("ngIf",a.getArrayFromGroup(t,"occupation").controls.length>0)("ngIfElse",i),e.xp6(19),e.Q6J("ngIf",a.getArrayFromGroup(t,"ratio").controls.length>0)("ngIfElse",r)}}function ye(o,n){if(1&o&&(e.ynx(0,1),e.TgZ(1,"nb-accordion",2),e.YNc(2,ke,54,6,"nb-accordion-item",3),e.qZA(),e.BQk()),2&o){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("ngForOf",t.workcentersControl.controls)}}let k=class{constructor(n,t){this.fb=n,this.cdr=t,this.editable=!0,this.workcentersFilter=[],this.workstationsFilter=[],this._workcenters=[],this.searchText="",this.openWorkcenterAddDialog=new e.vpe,this.formValuesChange=new e.vpe,this.isFormValid=new e.vpe}set workcenters(n){!(null==n?void 0:n.length)||n===this._workcenters||(this._workcenters=n,this.createworkCentersForm(),this.watchFormChanges())}get workcenters(){return this._workcenters}ngOnChanges(n){var t,i,r,a;this.workcentersFilter=null===(i=null===(t=null==n?void 0:n.selectedFilters)||void 0===t?void 0:t.currentValue)||void 0===i?void 0:i.workcenters,this.workstationsFilter=null===(a=null===(r=null==n?void 0:n.selectedFilters)||void 0===r?void 0:r.currentValue)||void 0===a?void 0:a.workstations}watchFormChanges(){this.form.valueChanges.pipe((0,b.t)(this)).subscribe(n=>{this.formValuesChange.emit(n),this.isFormValid.emit(this.form.valid)})}onOpenWorkcenterAddDialog(n,t){this.openWorkcenterAddDialog.emit({action:n,uuid:t})}onSelectedWorkstationChange(n,t,i,r){var a;if(!i.value)return;const c=null===(a=null==i?void 0:i.value)||void 0===a?void 0:a.uuid,s=[...this.workcenters.find(d=>d.uuid===c).workstations],p=s.find(d=>d.reference===n.value);s[t]=p,i.patchValue({[r]:s})}get workcentersControl(){var n;return null===(n=this.form)||void 0===n?void 0:n.get("workcentersPlan")}addWorkcenter(){this.workcentersControl.push(this.createWorkCenterGroup())}removeWorkcenter(n){this.workcentersControl.removeAt(n)}getWorkstations(n){return this.workcentersControl.at(n).get("workstations")}addWorkstation(n){this.getWorkstations(n).push(this.createOccupationGroup())}removeWorkstation(n){this.getWorkstations(n).removeAt(n)}onAddOccupation(n){this.getArrayFromGroup(n,"occupation").push(this.createOccupationGroup())}onAddRatio(n){this.getArrayFromGroup(n,"ratio").push(this.createRatioGroup())}onRemoveOccupation(n,t){this.getArrayFromGroup(n,"occupation").removeAt(t)}onRemoveRatio(n,t){this.getArrayFromGroup(n,"ratio").removeAt(t)}getWorkstationsList(n){var t;const i=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.uuid;return this.workcenters.find(a=>a.uuid===i).workstations}checkIfHasWorkstations(n){var t;return(null===(t=this.workcenters.find(n.value.uuid).workstations)||void 0===t?void 0:t.length)>0}getFilteredArrayGroup(n,t,i){return this.getArrayFromGroup(n,t).controls.filter(c=>""!==c.value.name).filter((c,u,s)=>s.findIndex(p=>p.value.reference===c.value.reference)===u)}createworkCentersForm(){this.form=this.fb.group({workcentersPlan:this.fb.array([...this.workcenters].map(n=>this.createWorkCenterGroup(n.name,n.uuid,n.workstations)))})}createWorkCenterGroup(n="",t="",i=[]){return this.fb.group({name:n,occupation:this.fb.array(i.map(r=>this.createOccupationGroup(r))),ratio:this.fb.array(i.map(r=>this.createRatioGroup(r))),uuid:t})}createOccupationGroup(n){var t,i,r,a,c,u,s,p,d,g;return this.fb.group({name:[null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"",_.kI.required],activity:null!==(r=null===(i=null==n?void 0:n.activity)||void 0===i?void 0:i.displayValue)&&void 0!==r?r:"",occupation:[null!==(a=null==n?void 0:n.occupation)&&void 0!==a?a:"",_.kI.required],startTime:[null!==(c=null==n?void 0:n.startTime)&&void 0!==c?c:"",_.kI.required],endTime:[null!==(u=null==n?void 0:n.endTime)&&void 0!==u?u:"",_.kI.required],reference:[null!==(s=null==n?void 0:n.reference)&&void 0!==s?s:"",_.kI.required],displayValue:null!==(p=null==n?void 0:n.displayValue)&&void 0!==p?p:"",uuid:null!==(d=null==n?void 0:n.uuid)&&void 0!==d?d:"",code:null!==(g=null==n?void 0:n.code)&&void 0!==g?g:""})}createRatioGroup(n){var t,i,r,a,c,u,s,p,d,g,v;return this.fb.group({name:[null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"",_.kI.required],activity:null!==(r=null===(i=null==n?void 0:n.activity)||void 0===i?void 0:i.displayValue)&&void 0!==r?r:"",ratio:[null!==(a=null==n?void 0:n.ratio)&&void 0!==a?a:"",_.kI.required],unitOfRatio:null!==(c=null==n?void 0:n.unitOfRatio)&&void 0!==c?c:"none",startTime:[null!==(u=null==n?void 0:n.startTime)&&void 0!==u?u:"",_.kI.required],endTime:[null!==(s=null==n?void 0:n.endTime)&&void 0!==s?s:"",_.kI.required],reference:[null!==(p=null==n?void 0:n.reference)&&void 0!==p?p:"",_.kI.required],displayValue:null!==(d=null==n?void 0:n.displayValue)&&void 0!==d?d:"",uuid:null!==(g=null==n?void 0:n.uuid)&&void 0!==g?g:"",code:null!==(v=null==n?void 0:n.code)&&void 0!==v?v:""})}castToFormGroup(n){return n}castToFormArray(n){return n}getArrayFromGroup(n,t,i){return n.get(t)}};function Ae(o,n){if(1&o&&(e.TgZ(0,"nb-option",16),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.s9C("value",t.uuid),e.xp6(1),e.Oqu(t.name)}}function Ze(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"label",12),e._uU(3,"Workcenter"),e.qZA()(),e.TgZ(4,"div",13)(5,"nb-select",14),e.NdJ("selectedChange",function(r){return e.CHM(t),e.oxw(2).onSelectWorkcenter(r)}),e.YNc(6,Ae,2,2,"nb-option",15),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(6),e.Q6J("ngForOf",t.workcenters)}}function Oe(o,n){1&o&&(e.TgZ(0,"div",10)(1,"div",7)(2,"p"),e._uU(3,"You have added all workcenters to the plan already."),e.qZA()()())}function Fe(o,n){if(1&o&&(e.TgZ(0,"div",6)(1,"div",7),e.YNc(2,Ze,7,1,"div",8),e.YNc(3,Oe,4,0,"ng-template",null,9,e.W1O),e.qZA()()),2&o){const t=e.MAs(4),i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.workcenters.length>0)("ngIfElse",t)}}function we(o,n){1&o&&(e.TgZ(0,"div",6)(1,"div",7)(2,"p"),e._uU(3,"Are you sure you want to remove this workcenter?"),e.qZA()()())}function Pe(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return"add"===r.action?r.onSave():r.onRemove()}),e._uU(1),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.hij(" ","add"===t.action?"Save":"Confirm"," ")}}k.\u0275fac=function(n){return new(n||k)(e.Y36(_.qu),e.Y36(e.sBO))},k.\u0275cmp=e.Xpm({type:k,selectors:[["app-plan-table"]],inputs:{workcenters:"workcenters",selectedFilters:"selectedFilters",searchText:"searchText"},outputs:{openWorkcenterAddDialog:"openWorkcenterAddDialog",formValuesChange:"formValuesChange",isFormValid:"isFormValid"},features:[e.TTD],decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["multi","","formArrayName","workcentersPlan"],["expanded","true",3,"formGroup",4,"ngFor","ngForOf"],["expanded","true",3,"formGroup"],[1,"accordion-header"],[1,"d-flex","justify-content-between"],[1,"accordion-title"],[1,"accordion-subtitle"],[1,"buttons-wrapper","workcenter-buttons","mb-3"],["type","button","icon","add_circle",1,"mr-1",3,"click"],["type","button","icon","cancel",1,"mr-1",3,"click"],[1,"tables-wrapper"],["formArrayName","occupation"],[4,"ngIf","ngIfElse"],["addButton",""],["formArrayName","ratio"],["addRatioButton",""],[3,"formGroup",4,"ngFor","ngForOf"],["status","primary","placeholder","Name","formControlName","reference",1,"select",3,"appEditable"],[3,"id","value","selectionChange",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["nbInput","","type","number","fullWidth","","status","primary","placeholder","occupation","formControlName","occupation"],["nbInput","","status","primary","primary","","fullWidth","","formControlName","startTime",3,"nbTimepicker"],["singleColumn","","format","h:mm:ss a",3,"step"],["timeFrom",""],["nbInput","","status","primary","primary","","fullWidth","","formControlName","endTime",3,"nbTimepicker"],["timeTo",""],["status","primary","placeholder","Time",1,"select"],["value","morning"],["value","evening"],[1,"buttons-wrapper"],[3,"id","value","selectionChange"],[1,"text-danger"],["type","number","nbInput","","fullWidth","","status","primary","placeholder","Ratio","formControlName","ratio"]],template:function(n,t){1&n&&e.YNc(0,ye,3,2,"ng-container",0),2&n&&e.Q6J("ngIf",t.form)},directives:[h.O5,_.JL,_.sg,l.qCO,_.CE,h.sg,l.SaG,l.YZd,l.AvE,l.fMN,l.rs,_.JJ,_.u,ae,l.q51,l.h8i,_.wV,_.Fj,l.etF,l.emG],styles:[".workcenter-buttons[_ngcontent-%COMP%]{position:absolute;right:0;top:0}"]}),k=(0,O.gn)([(0,b.c)()],k);let Ie=(()=>{class o{constructor(t){this.dialog=t,this.newWorkcenterUuid="",this.workcenters=[],this.action="",this.workcenterToRemoveUuid="",this.addWorkcenter=new e.vpe,this.removeWorkcenter=new e.vpe}onCloseDialog(){this.dialog.close()}onSelectWorkcenter(t){this.newWorkcenterUuid=t}onSave(){this.addWorkcenter.emit(this.newWorkcenterUuid)}onRemove(){this.removeWorkcenter.emit(!0)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.X4l))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-plan-add-workcenter-dialog"]],outputs:{addWorkcenter:"addWorkcenter",removeWorkcenter:"removeWorkcenter"},decls:14,vars:6,consts:[["icon","close",1,"close-dialog",3,"click"],["class","row mb-1",4,"ngIf","ngIfElse"],["confirmText",""],[1,"buttons","d-flex","justify-content-center","mt-5"],["nbButton","","outline","","size","medium","type","button",1,"mr-3",3,"click"],["nbButton","","status","primary","size","medium",3,"click",4,"ngIf"],[1,"row","mb-1"],[1,"col-12"],["class","row",4,"ngIf","ngIfElse"],["noWorkcentersInfo",""],[1,"row"],[1,"col-sm-3","d-flex","align-items-center"],["for","workcenter"],[1,"col-sm-9"],["fullWidth","","status","primary","placeholder","Select workcenter...",1,"select",3,"selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["nbButton","","status","primary","size","medium",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"nb-card")(1,"nb-card-header")(2,"h2"),e._uU(3),e.ALo(4,"titlecase"),e.qZA(),e.TgZ(5,"nb-icon",0),e.NdJ("click",function(){return i.onCloseDialog()}),e.qZA()(),e.TgZ(6,"nb-card-body"),e.YNc(7,Fe,5,2,"div",1),e.YNc(8,we,4,0,"ng-template",null,2,e.W1O),e.TgZ(10,"div",3)(11,"button",4),e.NdJ("click",function(){return i.onCloseDialog()}),e._uU(12,"Cancel"),e.qZA(),e.YNc(13,Pe,2,1,"button",5),e.qZA()()()),2&t){const r=e.MAs(9);e.xp6(3),e.hij("",e.lcZ(4,4,i.action)," workcenter"),e.xp6(4),e.Q6J("ngIf","add"===i.action)("ngIfElse",r),e.xp6(6),e.Q6J("ngIf",0!==i.workcenters.length||"remove"===i.action)}},directives:[l.Asz,l.ndF,l.fMN,l.yKW,h.O5,l.rs,h.sg,l.q51,l.DPz],pipes:[h.rS],styles:["nb-card[_ngcontent-%COMP%]{min-width:500px}"]}),o})(),De=(()=>{class o{constructor(t){this.dialog=t,this.name="",this.setScheduleName=new e.vpe}onCloseDialog(){this.dialog.close()}onSave(){this.setScheduleName.emit(this.name)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.X4l))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-plan-save-dialog"]],outputs:{setScheduleName:"setScheduleName"},decls:17,vars:1,consts:[["icon","close",1,"close-dialog",3,"click"],[1,"row","mb-1"],[1,"col-sm-3","d-flex","align-items-center"],["for","name"],[1,"col-sm-9"],["nbInput","","status","primary","fullWidth","","id","name","placeholder","Enter name",3,"ngModel","ngModelChange"],[1,"buttons","d-flex","justify-content-center","mt-5"],["nbButton","","outline","","size","medium","type","button",1,"mr-3",3,"click"],["nbButton","","status","primary","size","medium",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"nb-card")(1,"nb-card-header")(2,"h2"),e._uU(3,"Save schedule"),e.qZA(),e.TgZ(4,"nb-icon",0),e.NdJ("click",function(){return i.onCloseDialog()}),e.qZA()(),e.TgZ(5,"nb-card-body")(6,"div",1)(7,"div",2)(8,"label",3),e._uU(9,"Name"),e.qZA()(),e.TgZ(10,"div",4)(11,"input",5),e.NdJ("ngModelChange",function(a){return i.name=a}),e.qZA()()(),e.TgZ(12,"div",6)(13,"button",7),e.NdJ("click",function(){return i.onCloseDialog()}),e._uU(14,"Cancel"),e.qZA(),e.TgZ(15,"button",8),e.NdJ("click",function(){return i.onSave()}),e._uU(16,"Save"),e.qZA()()()()),2&t&&(e.xp6(11),e.Q6J("ngModel",i.name))},directives:[l.Asz,l.ndF,l.fMN,l.yKW,l.h8i,_.Fj,_.JJ,_.On,l.DPz],styles:["nb-card[_ngcontent-%COMP%]{min-width:500px}"]}),o})();var Q=m(567),D=m(8471);function Me(o,n){if(1&o&&(e.TgZ(0,"nb-option",10),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.name),e.xp6(1),e.Oqu(t.name)}}function Se(o,n){if(1&o&&(e.TgZ(0,"nb-option",10),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.name),e.xp6(1),e.Oqu(t.name)}}let qe=(()=>{class o{constructor(){this.selectedWorkcenters=[],this.selectedFilters={},this.workcenters=[],this.workstations=[],this.selectFilters=new e.vpe,this.allOptionValue="#all"}onSelectFilterChange(t,i,r,a,c){this.selectedFilters[a]=t,this.selectFilters.emit(this.selectedFilters)}getAllFiltersNames(t){return t.map(i=>i.name)}onSelectAll(t,i,r,a,c){i.options.forEach(u=>t?u.select():u.deselect())}updateAllOptionState(t){const i=t.options.toArray().filter(a=>a.value!==this.allOptionValue).every(a=>a.selected),r=t.options.find(a=>a.value===this.allOptionValue);i?null==r||r.select():null==r||r.deselect()}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-plan-filters"]],inputs:{workcenters:"workcenters",workstations:"workstations"},outputs:{selectFilters:"selectFilters"},decls:15,vars:2,consts:[[1,"filters"],[1,"filter"],["status","control","placeholder","Time",1,"select"],["value","morning"],["value","evening"],["multiple","","status","control","placeholder","Workcenter",1,"select",3,"selectedChange"],["workcenterSelect",""],[3,"value",4,"ngFor","ngForOf"],["multiple","","status","control","placeholder","Workstation",1,"select",3,"selectedChange"],["workstationSelect",""],[3,"value"]],template:function(t,i){if(1&t){const r=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"nb-select",2)(3,"nb-option",3),e._uU(4,"Morning"),e.qZA(),e.TgZ(5,"nb-option",4),e._uU(6,"Evening"),e.qZA()()(),e.TgZ(7,"div",1)(8,"nb-select",5,6),e.NdJ("selectedChange",function(c){e.CHM(r);const u=e.MAs(9);return i.onSelectFilterChange(c,u,i.workcenters,"workcenters",!1)}),e.YNc(10,Me,2,2,"nb-option",7),e.qZA()(),e.TgZ(11,"div",1)(12,"nb-select",8,9),e.NdJ("selectedChange",function(c){e.CHM(r);const u=e.MAs(13);return i.onSelectFilterChange(c,u,i.workstations,"workstations",!1)}),e.YNc(14,Se,2,2,"nb-option",7),e.qZA()()()}2&t&&(e.xp6(10),e.Q6J("ngForOf",i.workcenters),e.xp6(4),e.Q6J("ngForOf",i.workstations))},directives:[l.rs,l.q51,h.sg],styles:[""]}),o})(),Ne=(()=>{class o{constructor(){this.changeSearchText=new e.vpe}onChangeSearchText(t){this.changeSearchText.emit(t.target.value)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-search-input"]],outputs:{changeSearchText:"changeSearchText"},decls:3,vars:0,consts:[[1,"search-input-wrapper"],["status","primary","fullWidth","","nbInput","","placeholder","Search by: Workstation, Activity, Ratio",3,"input"],["icon","search",1,"search-input-icon"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"input",1),e.NdJ("input",function(a){return i.onChangeSearchText(a)}),e.qZA(),e._UZ(2,"nb-icon",2),e.qZA())},directives:[l.h8i,l.fMN],styles:[".search-input-wrapper[_ngcontent-%COMP%]{position:relative}.search-input-wrapper[_ngcontent-%COMP%]   .search-input-icon[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);right:15px}"]}),o})();function Ee(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"app-plan-table",18),e.NdJ("openWorkcenterAddDialog",function(r){return e.CHM(t),e.oxw().onOpenWorkcenterAddDialog(r)})("formValuesChange",function(r){return e.CHM(t),e.oxw().onFormChanges(r)})("isFormValid",function(r){return e.CHM(t),e.oxw().setIsFormValid(r)}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("workcenters",t.filteredData)("searchText",t.searchText)("selectedFilters",t.selectedFilters)}}let y=class{constructor(n,t,i,r,a,c,u){var s,p,d,g;this.workCenterApi=n,this.workStationApi=t,this.activityApi=i,this.siteOccupationApi=r,this.dialogService=a,this.cdr=c,this.router=u,this.editable=!1,this.searchText="",this.workCenters=[],this.workStations=[],this.activities=[],this.dataTree=[],this.plan=[],this.planName="",this.workcentersToAdd=[],this.filteredData=[],this.isFormValid=!1,this.planDate="",this.planOption="";const v=null===(g=null===(d=null===(p=null===(s=this.router)||void 0===s?void 0:s.getCurrentNavigation())||void 0===p?void 0:p.extras)||void 0===d?void 0:d.state)||void 0===g?void 0:g.planOption;this.planOption=v||"manual"}ngOnInit(){"manual"===this.planOption?this.fetchManualData():this.fetchPlanData()}fetchPlanData(){(0,Q.D)(this.workCenterApi.dataWorkCenterListGet(),this.workStationApi.dataWorkstationListGet(),this.activityApi.dataActivityListGet(),this.siteOccupationApi.dataSiteOccupationSiteOccupationPlanReferenceGet(this.planOption)).pipe((0,b.t)(this)).subscribe({next:([n,t,i,r])=>{var a;this.workCenters=n,this.workStations=t,this.activities=i,this.editedPlanData=r.content,this.planName=null===(a=r.content)||void 0===a?void 0:a.planName,this.buildDataTree()}})}fetchManualData(){(0,Q.D)(this.workCenterApi.dataWorkCenterListGet(),this.workStationApi.dataWorkstationListGet(),this.activityApi.dataActivityListGet()).pipe((0,b.t)(this)).subscribe({next:([n,t,i])=>{this.workCenters=n,this.workStations=t,this.activities=i,this.buildDataTree()}})}setIsFormValid(n){this.isFormValid=n}onFormChanges(n){this.plan=n.workcentersPlan}buildEditedPlanDataTree(){}buildDataTree(){this.dataTree=[...this.workCenters].map(n=>{var t;return null===(t=n.workstations)||void 0===t||t.forEach((i,r)=>{const a=i.reference,c=this.workStations.find(u=>u.uuid===a);n.workstations[r]=Object.assign(Object.assign({},n.workstations[r]),c)}),n}),this.filteredData=[...this.dataTree],console.log(this.dataTree),this.cdr.markForCheck()}selectFiltersHandler(n){if(this.selectedFilters=n,!this.selectedFilters)return;const{workcenters:t,workstations:i}=this.selectedFilters;let r=[...this.dataTree];return(null==t?void 0:t.length)&&(r=r.filter(a=>t.includes(a.name))),(null==i?void 0:i.length)&&(r=r.map(a=>Object.assign(Object.assign({},a),{workstations:a.workstations.filter(c=>i.includes(c.name))})).filter(a=>a.workstations.length)),this.filteredData=r,r}searchTextHandler(n,t){var i,r,a,c;this.searchText=n.toLowerCase();let u=(null===(r=null===(i=this.selectedFilters)||void 0===i?void 0:i.workcenters)||void 0===r?void 0:r.length)||(null===(c=null===(a=this.selectedFilters)||void 0===a?void 0:a.workstations)||void 0===c?void 0:c.length)?this.selectFiltersHandler(this.selectedFilters):[...this.dataTree];(null==n?void 0:n.length)&&(u=u.map(s=>Object.assign(Object.assign({},s),{workstations:s.workstations.filter(p=>{var d,g,v;return(null===(d=p.name.toLowerCase())||void 0===d?void 0:d.includes(n.toLowerCase()))||(null===(v=null===(g=p.activity)||void 0===g?void 0:g.displayValue.toLowerCase())||void 0===v?void 0:v.includes(n.toLowerCase()))})})).filter(s=>s.workstations.length)),this.filteredData=u}onOpenSaveScheduleDialog(){const n=this.dialogService.open(De);n.componentRef.instance.setScheduleName.pipe((0,b.t)(this)).subscribe(t=>{n.close(),t&&(this.planName=t,this.savePlan())})}formatPlanData(n){return n.map(i=>(i.occupation.forEach(r=>{r.startTime=this.formatTime(r.startTime)}),i.ratio.forEach(r=>{r.startTime=this.formatTime(r.startTime)}),i))}formatTime(n){const t=new Date(n);return t?{hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds()}:""}savePlan(){const n={planReference:this.planName,isTemplate:!0,workCenterPlans:this.formatPlanData([...this.plan])};this.siteOccupationApi.dataSiteOccupationSavePlanPost(n).pipe((0,b.t)(this)).subscribe({next:t=>{console.log(t)}})}onOpenWorkcenterAddDialog(n){const t=this.dialogService.open(Ie);t.componentRef.instance.workcenters=this.workcentersToAdd,t.componentRef.instance.action=n.action,t.componentRef.instance.addWorkcenter.pipe((0,b.t)(this)).subscribe(i=>{if(t.close(),i){const r=this.workCenters.find(c=>c.uuid===i),a=[...this.dataTree,r];this.dataTree=a,this.cdr.markForCheck()}}),t.componentRef.instance.removeWorkcenter.pipe((0,b.t)(this)).subscribe(i=>{if(t.close(),"remove"===(null==n?void 0:n.action)&&(null==n?void 0:n.uuid)){const r=this.workCenters.find(c=>c.uuid===(null==n?void 0:n.uuid));this.workcentersToAdd=[...this.workcentersToAdd,r];const a=this.dataTree.filter(c=>c.uuid!==(null==n?void 0:n.uuid));this.dataTree=a,this.cdr.markForCheck()}})}};y.\u0275fac=function(n){return new(n||y)(e.Y36(D.Uv),e.Y36(D.F),e.Y36(D.B0),e.Y36(U.j),e.Y36(l.Gln),e.Y36(e.sBO),e.Y36(P.F0))},y.\u0275cmp=e.Xpm({type:y,selectors:[["app-plan-create"]],decls:22,vars:7,consts:[[1,"plan-header","mt-3"],[1,"row","mb-3"],[1,"col-12","col-sm-12","col-md-7"],[1,"mt-0"],[1,""],[1,"date-wrapper","mb-1"],["nbInput","","status","control","placeholder","Date",3,"nbDatepicker","ngModel","ngModelChange"],["format","MM\\dd\\yyyy"],["date",""],[3,"workcenters","workstations","selectFilters"],[1,"col-12","col-sm-12","col-md-5","d-flex","flex-column","justify-content-between"],[3,"changeSearchText"],[1,"buttons","mt-3","d-flex","justify-content-end"],["nbButton","","status","primary","size","medium",1,"icon-button",3,"disabled","click"],["icon","check_circle"],[1,"icon-button-text"],["nbButton","","status","primary","size","medium",1,"ml-1",3,"disabled","click"],[3,"workcenters","searchText","selectedFilters","openWorkcenterAddDialog","formValuesChange","isFormValid",4,"ngIf"],[3,"workcenters","searchText","selectedFilters","openWorkcenterAddDialog","formValuesChange","isFormValid"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),e._uU(4,"Plan"),e.qZA(),e.TgZ(5,"div",4)(6,"div",5)(7,"input",6),e.NdJ("ngModelChange",function(r){return t.planDate=r}),e.qZA(),e._UZ(8,"nb-datepicker",7,8),e.qZA(),e.TgZ(10,"div")(11,"app-plan-filters",9),e.NdJ("selectFilters",function(r){return t.selectFiltersHandler(r)}),e.qZA()()()(),e.TgZ(12,"div",10)(13,"app-search-input",11),e.NdJ("changeSearchText",function(r){return t.searchTextHandler(r)}),e.qZA(),e.TgZ(14,"div",12)(15,"button",13),e.NdJ("click",function(){return t.savePlan()}),e._UZ(16,"nb-icon",14),e.TgZ(17,"span",15),e._uU(18," Save all"),e.qZA()(),e.TgZ(19,"button",16),e.NdJ("click",function(){return t.onOpenSaveScheduleDialog()}),e._uU(20," Save shedule "),e.qZA()()()(),e.YNc(21,Ee,1,3,"app-plan-table",17),e.qZA()),2&n){const i=e.MAs(9);e.xp6(7),e.Q6J("nbDatepicker",i)("ngModel",t.planDate),e.xp6(4),e.Q6J("workcenters",t.workCenters)("workstations",t.workStations),e.xp6(4),e.Q6J("disabled",!t.isFormValid),e.xp6(4),e.Q6J("disabled",!t.isFormValid),e.xp6(2),e.Q6J("ngIf",t.dataTree)}},directives:[l.h8i,l.$kf,_.Fj,_.JJ,_.On,l.B4C,qe,Ne,l.DPz,l.fMN,h.O5,k],styles:[""]}),y=(0,O.gn)([(0,b.c)()],y);let A=class{constructor(n){this.api=n,this.plans=[],this.loading=!1}ngOnInit(){}getSiteOccupationPlans(){this.api.dataOccupationListGet().pipe((0,b.t)(this)).subscribe(n=>{this.plans=n},n=>{console.log(n)})}};A.\u0275fac=function(n){return new(n||A)(e.Y36(N.Pb))},A.\u0275cmp=e.Xpm({type:A,selectors:[["ng-component"]],decls:2,vars:1,consts:[["nbSpinnerStatus","basic",1,"plan-list-wrapper",3,"nbSpinner"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"app-start-setting-up-plans"),e.qZA()),2&n&&e.Q6J("nbSpinner",t.loading)},directives:[l.Q7R,re],styles:[".nb-spinner-container[_ngcontent-%COMP%]{min-height:300px}"]}),A=(0,O.gn)([(0,b.c)()],A);const Je=[{path:"",component:A},{path:"manual",component:y}];let Ue=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[P.Bz.forChild(Je)],P.Bz]}),o})();var We=m(8242),Qe=m(1428);let Ye=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.ez,Ue,oe,l.T2N,l.zyh,l.KdK,l.uuI,l.oGl,l.OA,l.kmq,l.nKr,l.IIj,E,J,Y,_.UX,We.i,Qe.k,_.u5,l.COg]]}),o})()}}]);